<!DOCTYPE html>
<html lang="sr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>O nama – Plavi tok</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600;800&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" />
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
  <style>
    :root { 
      --bg:#ffffff; 
      --ink:#0f1115; 
      --muted:#4b5563; 
      --line:#e5e7eb; 
      --accent:#d4af37;
      --nav-h:120px;
    }
    * { box-sizing: border-box; font-family: 'Montserrat', system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; }
    body { margin: 0; background: var(--bg); color: var(--ink); }

    /* ===== NAV (kao na katalogu) ===== */
    .nav-left a { display: inline-block; background: #ffffff; padding: 6px 10px; border-radius: 10px; }
    .nav-left img { height: 64px; width: auto; display: block; }
    @media (max-width: 768px) { .nav-left img { height: 50px; } }
    .nav { position: fixed; top: 28px; left: 40px; right: 40px; z-index: 200; display: flex; align-items: center; justify-content: space-between; pointer-events: none; }
    .nav-left { font-size: 12px; letter-spacing: .18em; text-transform: uppercase; color: #fff; opacity: .9; pointer-events: auto; user-select: none; }
    .nav-burger { width: 54px; height: 54px; border: 0; border-radius: 6px; background: rgba(255,255,255,0.96); display: grid; place-items: center; cursor: pointer; pointer-events: auto; }
    .nav-burger span { display: block; width: 22px; height: 2px; background: #111; margin: 3px 0; transition: transform .25s ease, opacity .25s ease; }
    .nav-overlay { position: fixed; inset: 0; background: rgba(0,0,0,.88); display: none; z-index: 300; }
    .nav-overlay.open { display: flex; }
    .nav-close { position: absolute; top: 28px; right: 40px; width: 54px; height: 54px; border: 0; border-radius: 6px; background: rgba(255,255,255,0.96); font-size: 28px; line-height: 1; cursor: pointer; }
    .nav-links { margin: auto; display: flex; flex-direction: column; gap: 18px; align-items: center; }
    .nav-links a { color: #fff; text-decoration: none; font-size: 28px; font-weight: 700; letter-spacing: .02em; opacity: .95; }
    .nav-links a:hover { opacity: 1; }
    @media (max-width: 768px) {
      .nav { left: 16px; right: 16px; top: 18px; }
      .nav-left { font-size: 10px; letter-spacing: .14em; }
      .nav-burger, .nav-close { width: 46px; height: 46px; }
      .nav-links a { font-size: 22px; }
    }
    .nav-band { position: fixed; top: 0; left: 0; right: 0; height: var(--nav-h); background: #0b0d12; z-index: 120; }
    @media (max-width: 768px){ :root{ --nav-h:100px; } }

    /* Social icons */
    .social-icons { position: sticky; bottom: 20px; left: auto; margin-left: 20px; z-index: 100; display: flex; flex-direction: column; gap: 10px; }
    .social-icons a { color: #1c1c1e; font-size: 1.7rem; opacity: 0.9; transition: opacity 0.3s; }
    .social-icons a:hover { opacity: 1; }

    .page { min-height: 100vh; padding-top: var(--nav-h); }

    /* ===== HERO edge-to-edge ===== */
    .hero-bleed { width: 100vw; margin-left: calc(50% - 50vw); margin-right: calc(50% - 50vw);  margin-top: calc(var(--nav-h) * -1); }
    .hero-bleed img { width: 100%; height: min(72vh, 880px); object-fit: cover; display: block; filter: saturate(1.05) contrast(1.03); }
    .hero-shadow { height: 24px; background: linear-gradient(to bottom, rgba(0,0,0,.55), rgba(0,0,0,0)); }

    /* ===== CONTENT GRID: head spans, then text + stats aligned ===== */
    .wrap { max-width: 1280px; margin: 0 auto; padding: 40px 24px 120px; }
    .content-grid{
      display: grid;
      grid-template-columns: minmax(0,1fr) 320px;
      grid-template-areas:
        "head head"
        "copy stats";
      column-gap: 36px;
      row-gap: 16px;
      align-items: start;
    }
    @media (max-width: 1100px){
      .content-grid{ grid-template-columns: 1fr; grid-template-areas: "head" "copy" "stats"; }
    }

    .about-head { grid-area: head; }
    .copy { grid-area: copy; }
    .stats-rail { grid-area: stats; position: relative; display: flex; flex-direction: column; gap: 12px; align-self: start; }

    /* H1 exactly like index: 3rem, 800, 1.05 */
    .about-head h1 { font-size: 3rem; line-height: 1.05; font-weight: 800; margin: 4px 0 10px;  color:#0f1115; }
    .gold-rule { width: 120px; height: 2px; background: var(--accent); margin: 12px 0 18px; border-radius: 2px; }

    .lead { color: var(--muted); font-size: clamp(16px, 1.25vw, 20px); line-height: 1.8; max-width: 920px; }

    .rail-item { display: grid; grid-template-columns: 40px 1fr; align-items: center; gap: 12px; padding: 12px 16px 12px 12px; border-left: 2px solid var(--accent); background: rgba(12,13,16,0.6); backdrop-filter: blur(6px); border-radius: 14px; box-shadow: 0 2px 14px rgba(0,0,0,.25); }
    .rail-item i { font-size: 20px; color: var(--accent); }
    .rail-item .k { font-weight: 800; font-size: 18px; letter-spacing: .02em; color: #f9fafb; }
    .rail-item .l { color:#f9fafb; font-size: 12px; }
    @media (max-width: 640px){ .rail-item { grid-template-columns: 28px 1fr; border-radius: 12px; } .rail-item .k { font-size: 16px; } }

    /* ===== Footer ===== */
    .site-footer { background:#0b0d12; color:#e5e7eb; margin-top:0; border-top:1px solid #1f2937; }
    .cta { background:linear-gradient(90deg, #111827, #0b0d12); border-bottom:1px solid #1f2937; }
    .cta .inner { max-width:1280px; margin:0 auto; padding:28px 20px; display:flex; justify-content:space-between; align-items:center; gap:16px; flex-wrap:wrap; }
    .cta h3 { margin:0; color:#f9fafb; }
    .cta p { margin:0; color:#9ca3af; }
    .cta .row { display:flex; gap:10px; flex-wrap:wrap; }
    .btn-primary { background:#ffffff; color:#0f1115; border:0; padding:12px 16px; border-radius:10px; font-weight:700; cursor:pointer; text-decoration:none; }
    .btn-secondary { background:#111827; color:#f9fafb; border:1px solid #1f2937; padding:12px 16px; border-radius:10px; font-weight:700; text-decoration:none; }
    .site-footer .wrap { max-width:1280px; margin:0 auto; padding:18px 20px;  grid-template-columns:1fr 1fr; gap:28px; }
    .links { display:flex; gap:18px; flex-wrap:wrap; }
    .links a { color:#e5e7eb; text-decoration:none; opacity:.92; }
    .links a:hover { opacity:1; text-decoration:underline; }
    .bottom { border-top:1px solid #1f2937; }
    .bottom .inner { max-width:1280px; margin:0 auto; padding:14px 20px; display:flex; justify-content:space-between; align-items:center; color:#9ca3af; font-size:13px; }
  
        a, .copy a { color:#111827; }
        a:hover, .copy a:hover { text-decoration: underline; }
        
.rail-item .l{color:#f9fafb;}

/* === CHAT WIDGET (from catalog) === */
.chat-widget {
        position: fixed;
        bottom: 20px;
        right: 20px;
        width: 300px;
        height: 400px;
        background-color: white;
        border-radius: 10px;
        box-shadow: 0 0 10px rgba(0, 0, 0, 0.2);
        z-index: 1000;
        display: none;
        flex-direction: column;
    }
    .chat-header {
        background-color: #333;
        color: white;
        padding: 10px;
        border-top-left-radius: 10px;
        border-top-right-radius: 10px;
        text-align: center;
        display: flex;
        justify-content: space-between;
        align-items: center;
    }
    .chat-header button {
        background: none;
        border: none;
        color: white;
        cursor: pointer;
        font-size: 1.2rem;
        margin-left: 10px;
    }
    .chat-body {
        flex: 1;
        padding: 10px;
        overflow-y: auto;
        display: flex;
        flex-direction: column;
        gap: 8px;
    }
    .chat-input {
        display: flex;
        padding: 10px;
        border-top: 1px solid #ccc;
    }
    .chat-input input {
        flex: 1;
        padding: 8px;
        border: 1px solid #ccc;
        border-radius: 5px;
        margin-right: 5px;
    }
    .chat-input button {
        padding: 8px 12px;
        background-color: #d4a017;
        color: white;
        border: none;
        border-radius: 5px;
        cursor: pointer;
    }
    .message { margin-bottom: 0; }
    .message.user { text-align: right; display:flex; justify-content:flex-end; }
    .message.bot { text-align: left; display:flex; justify-content:flex-start; }
    .message .bubble {
        padding: 10px 14px;
        border-radius: 16px;
        max-width: 80%;
        line-height: 1.35;
        word-wrap: break-word;
        white-space: pre-wrap;
        box-shadow: 0 1px 2px rgba(0,0,0,0.08);
    }
    .message.user .bubble { background: #f0f0f0; color: #111; }
    .message.bot .bubble { background: #fff; color: #111; border: 1px solid rgba(0,0,0,0.08); }
    @media (max-width: 768px) {
        .chat-widget { width: 250px; height: 300px; }
    }

    /* Placeholder hero when no image */
    .hero-bleed.is-empty{ background:#f3f4f6; height: min(72vh, 880px); }
    .hero-bleed.is-empty .hero-shadow{ display:block; }

/* Extra space below each quarry section */
.hero-bleed + .wrap { margin-bottom: 172px; }
@media (max-width: 768px){
  /* Make full image visible on mobile and keep hero equal to image height */
  .hero-bleed img { height: auto; max-height: 100vh; width: 100%; object-fit: contain; }
  .hero-bleed.is-empty{ height: min(60vh, 600px); } /* keep placeholder reasonable on mobile */
  .hero-shadow { display: none; } /* section height = image height */
}
@media (max-width: 768px){
  /* Ensure first hero starts exactly below header on mobile */
  .hero-bleed:first-of-type { margin-top: 0; }
  /* Keep smaller titles on mobile */
  .about-head h1 { font-size: 2rem; line-height: 1.12; }
}
  /* Make section titles a bit smaller on mobile */
  .about-head h1 { font-size: 2rem; line-height: 1.12; }
}
</style>

        
</head>
<body>
  <div class="nav-band"></div>
  <!-- NAV + Overlay -->
  <div class="nav">
    <div class="nav-left">
      <a href="https://ibb.co/QGRBCQd"><img src="https://i.ibb.co/8Vp3dsc/Screenshot-1.png" alt="Logo" border="0"></a>
    </div>
    <button class="nav-burger" id="navBurger" aria-label="Open menu">
      <span></span><span></span><span></span>
    </button>
  </div>
  <div class="nav-overlay" id="navOverlay">
    <button class="nav-close" id="navClose" aria-label="Close menu">×</button>
    <nav class="nav-links">
      <a href="index.html">Početna</a>
      <a href="about.html">O nama</a>
      <a href="catalog.html">Katalog</a><a href="blog.html">Blog</a>
      <a href="contact.html">Kontakt</a>
    </nav>
  </div>

  <div class="page">
    <!-- HERO edge-to-edge -->
    <figure class="hero-bleed">
      <img id="heroImg" src="images/o nama/hero 1.png" alt="Trešnjica – Plavi tok, hero slika" />
      <div class="hero-shadow"></div>
    </figure>

    <!-- CONTENT GRID -->
    <div class="wrap">
      <div class="content-grid">
        <header class="about-head">
          <div class="gold-rule"></div>
          <h1 id="qName">Trešnjica – Plavi tok</h1>
        </header>

        <div class="copy">
          <p class="lead" id="qDesc">
            Kamenolom Trešnjica – Plavi tok obeležava 70 godina tradicije u vađenju i obradi autohtonog srpskog mermera.
            Ovaj odsek posluje sa savremenom opremom i standardima kvaliteta, uz fokus na stabilne isporuke i preciznu obradu.
          </p>
        </div>

        
        <aside class="stats-rail" aria-label="Statistika kamenoloma">
          <div class="rail-item">
            <i class="fa-solid fa-mountain"></i>
            <div>
              <div class="k" id="stExtraction">5.000 m³</div>
              <div class="l">Danas stvaramo za vas</div>
            </div>
          </div>
          <div class="rail-item">
            <i class="fa-solid fa-ruler-combined"></i>
            <div>
              <div class="k" id="stSlabs">20.000 m²</div>
              <div class="l">Isporučujemo kvalitet bez kompromisa</div>
            </div>
          </div>
          <div class="rail-item">
            <i class="fa-solid fa-award"></i>
            <div>
              <div class="k" id="stTradition">70 godina</div>
              <div class="l">tradicije</div>
            </div>
          </div>
          <div class="rail-item">
            <i class="fa-solid fa-vector-square"></i>
            <div>
              <div class="k" id="stLegacy">1.500.000 m²</div>
              <div class="l">Sedam decenija stvaranja</div>
            </div>
          </div>
        </aside>

      </div>
    </div>
  </div>


    <!-- HERO 2 edge-to-edge (placeholder until Excel provides image) -->
    <figure class="hero-bleed is-empty" id="heroFig2">
      <img id="heroImg2" src="" alt="" style="display:none" />
      <div class="hero-shadow"></div>
    </figure>

    <!-- CONTENT GRID 2 -->
    <div class="wrap">
      <div class="content-grid">
        <header class="about-head">
          <div class="gold-rule"></div>
          <h1 id="qName2"></h1>
        </header>

        <div class="copy">
          <p class="lead" id="qDesc2"></p>
        </div>

        <aside class="stats-rail" id="stats2" aria-label="Statistika kamenoloma">
          <div class="rail-item">
            <i class="fa-solid fa-mountain"></i>
            <div>
              <div class="k" id="stExtraction2"></div>
              <div class="l">Danas stvaramo za vas</div>
            </div>
          </div>
          <div class="rail-item">
            <i class="fa-solid fa-ruler-combined"></i>
            <div>
              <div class="k" id="stSlabs2"></div>
              <div class="l">Isporučujemo kvalitet bez kompromisa</div>
            </div>
          </div>
          <div class="rail-item">
            <i class="fa-solid fa-award"></i>
            <div>
              <div class="k" id="stTradition2"></div>
              <div class="l">tradicije</div>
            </div>
          </div>
          <div class="rail-item">
            <i class="fa-solid fa-vector-square"></i>
            <div>
              <div class="k" id="stLegacy2"></div>
              <div class="l">Sedam decenija stvaranja</div>
            </div>
          </div>
        </aside>
      </div>
    </div>



    <!-- HERO 3 edge-to-edge (placeholder until Excel provides image) -->
    <figure class="hero-bleed is-empty" id="heroFig3">
      <img id="heroImg3" src="" alt="" style="display:none" />
      <div class="hero-shadow"></div>
    </figure>

    <!-- CONTENT GRID 3 -->
    <div class="wrap">
      <div class="content-grid">
        <header class="about-head">
          <div class="gold-rule"></div>
          <h1 id="qName3"></h1>
        </header>

        <div class="copy">
          <p class="lead" id="qDesc3"></p>
        </div>

        <aside class="stats-rail" id="stats3" aria-label="Statistika kamenoloma">
          <div class="rail-item">
            <i class="fa-solid fa-mountain"></i>
            <div>
              <div class="k" id="stExtraction3"></div>
              <div class="l">Danas stvaramo za vas</div>
            </div>
          </div>
          <div class="rail-item">
            <i class="fa-solid fa-ruler-combined"></i>
            <div>
              <div class="k" id="stSlabs3"></div>
              <div class="l">Isporučujemo kvalitet bez kompromisa</div>
            </div>
          </div>
          <div class="rail-item">
            <i class="fa-solid fa-award"></i>
            <div>
              <div class="k" id="stTradition3"></div>
              <div class="l">tradicije</div>
            </div>
          </div>
          <div class="rail-item">
            <i class="fa-solid fa-vector-square"></i>
            <div>
              <div class="k" id="stLegacy3"></div>
              <div class="l">Sedam decenija stvaranja</div>
            </div>
          </div>
        </aside>
      </div>
    </div>

    <!-- HERO 4 edge-to-edge (placeholder until Excel provides image) -->
    <figure class="hero-bleed is-empty" id="heroFig4">
      <img id="heroImg4" src="" alt="" style="display:none" />
      <div class="hero-shadow"></div>
    </figure>

    <!-- CONTENT GRID 4 -->
    <div class="wrap">
      <div class="content-grid">
        <header class="about-head">
          <div class="gold-rule"></div>
          <h1 id="qName4"></h1>
        </header>

        <div class="copy">
          <p class="lead" id="qDesc4"></p>
        </div>

        <aside class="stats-rail" id="stats4" aria-label="Statistika kamenoloma">
          <div class="rail-item">
            <i class="fa-solid fa-mountain"></i>
            <div>
              <div class="k" id="stExtraction4"></div>
              <div class="l">Danas stvaramo za vas</div>
            </div>
          </div>
          <div class="rail-item">
            <i class="fa-solid fa-ruler-combined"></i>
            <div>
              <div class="k" id="stSlabs4"></div>
              <div class="l">Isporučujemo kvalitet bez kompromisa</div>
            </div>
          </div>
          <div class="rail-item">
            <i class="fa-solid fa-award"></i>
            <div>
              <div class="k" id="stTradition4"></div>
              <div class="l">tradicije</div>
            </div>
          </div>
          <div class="rail-item">
            <i class="fa-solid fa-vector-square"></i>
            <div>
              <div class="k" id="stLegacy4"></div>
              <div class="l">Sedam decenija stvaranja</div>
            </div>
          </div>
        </aside>
      </div>
    </div>


  <!-- Social -->
  <div class="social-icons">
    <a href="#"><i class="fab fa-instagram"></i></a>
    <a href="#"><i class="fab fa-facebook-f"></i></a>
    <a href="#"><i class="fab fa-tiktok"></i></a>
    <a href="#"><i class="fab fa-youtube"></i></a>
    <a href="#"><i class="fab fa-x-twitter"></i></a>
    <a href="#"><i class="fab fa-whatsapp"></i></a>
  </div>

  <!-- Footer -->
  

  <script>
    // Hamburger behavior
    const navBurger = document.getElementById('navBurger');
    const navOverlay = document.getElementById('navOverlay');
    const navClose  = document.getElementById('navClose');
    if (navBurger && navOverlay && navClose) {
      navBurger.addEventListener('click', () => { navOverlay.classList.add('open'); });
      navClose.addEventListener('click', () => { navOverlay.classList.remove('open'); });
      navOverlay.addEventListener('click', (e) => { if (e.target === navOverlay) navOverlay.classList.remove('open'); });
    }

    // Excel-driven content
    async function loadAboutXlsx() {
      try {
        const res = await fetch('about.xlsx');
        if (!res.ok) throw new Error('about.xlsx nije pronađen');
        const buf = await res.arrayBuffer();
        const wb = XLSX.read(buf, { type: 'array' });
        const Q = XLSX.utils.sheet_to_json(wb.Sheets['QUARRIES'] || {}, {defval: ''});
        return { QUARRIES: Q };
      } catch (e) { return null; }
    }
    function fmtNum(n, suffix) {
      if (n === '' || n == null) return '';
      const num = Number(String(n).replace(/[^0-9.]/g,''));
      if (!isFinite(num)) return String(n);
      return new Intl.NumberFormat('sr-RS').format(num) + (suffix||'');
    }
    (async function(){
      const data = await loadAboutXlsx();
      const q = data && data.QUARRIES && data.QUARRIES[0];
      if (!q) return;
      const hero = document.getElementById('heroImg');
      if (q.hero1_image) hero.src = q.hero1_image;
      const qName = document.getElementById('qName');
      const qDesc = document.getElementById('qDesc');
      if (q.name) qName.textContent = q.name;
      if (q.description) qDesc.textContent = q.description;
      const stExtraction = document.getElementById('stExtraction');
      const stSlabs = document.getElementById('stSlabs');
      const stTradition = document.getElementById('stTradition');
      const stLegacy = document.getElementById('stLegacy');
      const stEmployees = document.getElementById('stEmployees');
      const stProjects = document.getElementById('stProjects');
      if (stExtraction && q.annual_extraction_m3 !== undefined) stExtraction.textContent = String(q.annual_extraction_m3).trim();
      if (stSlabs && q.annual_slab_production_m2 !== undefined) stSlabs.textContent = String(q.annual_slab_production_m2).trim();
      if (stTradition && q.tradition_years) stTradition.textContent = fmtNum(q.tradition_years, ' godina');
      if (stLegacy && q.legacy_area_m2) stLegacy.textContent = fmtNum(q.legacy_area_m2, ' m²');
      if (stEmployees && q.employees) stEmployees.textContent = fmtNum(q.employees, '');
      if (stProjects && q.projects_since_2016) stProjects.textContent = fmtNum(q.projects_since_2016, '');
      // ==== Row 2 (drugi kamenolom) ====
      const q2 = data && data.QUARRIES && data.QUARRIES[1];
      const hero2 = document.getElementById('heroImg2');
      const heroFig2 = document.getElementById('heroFig2');
      const qName2 = document.getElementById('qName2');
      const qDesc2 = document.getElementById('qDesc2');
      const stExtraction2 = document.getElementById('stExtraction2');
      const stSlabs2 = document.getElementById('stSlabs2');
      const stTradition2 = document.getElementById('stTradition2');
      const stLegacy2 = document.getElementById('stLegacy2');
      const stats2 = document.getElementById('stats2');

      if (q2){
        // Hero image for second quarry: prefer hero2_image, then hero_image
        const src2 = (q2.hero2_image || q2.hero_image || '').trim();
        if (src2){
          hero2.src = src2;
          hero2.style.display = 'block';
          heroFig2.classList.remove('is-empty');
        } else {
          hero2.style.display = 'none';
          heroFig2.classList.add('is-empty');
        }

        if (q2.name) qName2.textContent = q2.name;
        if (q2.description) qDesc2.textContent = q2.description;

        // Values: first two use raw strings from Excel (can include jedinice)
        if (stExtraction2 && q2.annual_extraction_m3 !== undefined) stExtraction2.textContent = String(q2.annual_extraction_m3).trim();
        if (stSlabs2 && q2.annual_slab_production_m2 !== undefined) stSlabs2.textContent = String(q2.annual_slab_production_m2).trim();
        if (stTradition2 && q2.tradition_years) stTradition2.textContent = fmtNum(q2.tradition_years, ' godina');
        if (stLegacy2 && q2.legacy_area_m2) stLegacy2.textContent = fmtNum(q2.legacy_area_m2, ' m²');

        // Hide stats rail if all four values are empty
        const allEmpty = (!stExtraction2.textContent.trim()) && (!stSlabs2.textContent.trim()) && (!stTradition2.textContent.trim()) && (!stLegacy2.textContent.trim());
        if (stats2 && allEmpty) stats2.style.display = 'none';
      } else {
        // No second row yet: keep placeholder hero as empty block and hide empty stats
        if (heroFig2) heroFig2.classList.add('is-empty');
        if (hero2) hero2.style.display = 'none';
        if (stats2) stats2.style.display = 'none';
      }

    
      // ==== Row 3 (treći kamenolom) ====
      const q3 = data && data.QUARRIES && data.QUARRIES[2];
      const hero3 = document.getElementById('heroImg3');
      const heroFig3 = document.getElementById('heroFig3');
      const qName3 = document.getElementById('qName3');
      const qDesc3 = document.getElementById('qDesc3');
      const stExtraction3 = document.getElementById('stExtraction3');
      const stSlabs3 = document.getElementById('stSlabs3');
      const stTradition3 = document.getElementById('stTradition3');
      const stLegacy3 = document.getElementById('stLegacy3');
      const stats3 = document.getElementById('stats3');

      if (q3){
        const src3 = (q3.hero3_image || q3.hero_image || '').trim();
        if (src3){ hero3.src = src3; hero3.style.display = 'block'; heroFig3.classList.remove('is-empty'); }
        else { if (hero3) hero3.style.display = 'none'; if (heroFig3) heroFig3.classList.add('is-empty'); }
        if (q3.name) qName3.textContent = q3.name;
        if (q3.description) qDesc3.textContent = q3.description;
        if (stExtraction3 && q3.annual_extraction_m3 !== undefined) stExtraction3.textContent = String(q3.annual_extraction_m3).trim();
        if (stSlabs3 && q3.annual_slab_production_m2 !== undefined) stSlabs3.textContent = String(q3.annual_slab_production_m2).trim();
        if (stTradition3 && q3.tradition_years) stTradition3.textContent = fmtNum(q3.tradition_years, ' godina');
        if (stLegacy3 && q3.legacy_area_m2) stLegacy3.textContent = fmtNum(q3.legacy_area_m2, ' m²');
        const allEmpty3 = (!stExtraction3?.textContent.trim()) && (!stSlabs3?.textContent.trim()) && (!stTradition3?.textContent.trim()) && (!stLegacy3?.textContent.trim());
        if (stats3 && allEmpty3) stats3.style.display = 'none';
      } else {
        if (heroFig3) heroFig3.classList.add('is-empty');
        if (hero3) hero3.style.display = 'none';
        if (stats3) stats3.style.display = 'none';
      }

      // ==== Row 4 (četvrti kamenolom) ====
      const q4 = data && data.QUARRIES && data.QUARRIES[3];
      const hero4 = document.getElementById('heroImg4');
      const heroFig4 = document.getElementById('heroFig4');
      const qName4 = document.getElementById('qName4');
      const qDesc4 = document.getElementById('qDesc4');
      const stExtraction4 = document.getElementById('stExtraction4');
      const stSlabs4 = document.getElementById('stSlabs4');
      const stTradition4 = document.getElementById('stTradition4');
      const stLegacy4 = document.getElementById('stLegacy4');
      const stats4 = document.getElementById('stats4');

      if (q4){
        const src4 = (q4.hero4_image || q4.hero_image || '').trim();
        if (src4){ hero4.src = src4; hero4.style.display = 'block'; heroFig4.classList.remove('is-empty'); }
        else { if (hero4) hero4.style.display = 'none'; if (heroFig4) heroFig4.classList.add('is-empty'); }
        if (q4.name) qName4.textContent = q4.name;
        if (q4.description) qDesc4.textContent = q4.description;
        if (stExtraction4 && q4.annual_extraction_m3 !== undefined) stExtraction4.textContent = String(q4.annual_extraction_m3).trim();
        if (stSlabs4 && q4.annual_slab_production_m2 !== undefined) stSlabs4.textContent = String(q4.annual_slab_production_m2).trim();
        if (stTradition4 && q4.tradition_years) stTradition4.textContent = fmtNum(q4.tradition_years, ' godina');
        if (stLegacy4 && q4.legacy_area_m2) stLegacy4.textContent = fmtNum(q4.legacy_area_m2, ' m²');
        const allEmpty4 = (!stExtraction4?.textContent.trim()) && (!stSlabs4?.textContent.trim()) && (!stTradition4?.textContent.trim()) && (!stLegacy4?.textContent.trim());
        if (stats4 && allEmpty4) stats4.style.display = 'none';
      } else {
        if (heroFig4) heroFig4.classList.add('is-empty');
        if (hero4) hero4.style.display = 'none';
        if (stats4) stats4.style.display = 'none';
      }
})();
  </script>

<div class="chat-widget" id="chatWidget">
        <div class="chat-header">Chat sa Grok-om
            <button onclick="minimizeMaximizeChatWidget()" id="minimizeMaximizeButton">-</button>
            <button onclick="closeChatWidget()">X</button>
        </div>
        <div class="chat-body" id="chatBody"></div>
        <div class="chat-input">
            <input type="text" id="chatInput" placeholder="Postavi pitanje...">
            <button onclick="sendMessage()">Pošalji</button>
        </div>
    </div>
    

    
<script>
    // Hamburger behavior (same as on index)
    const navBurger = document.getElementById('navBurger');
    const navOverlay = document.getElementById('navOverlay');
    const navClose  = document.getElementById('navClose');
    if (navBurger && navOverlay && navClose) {
      navBurger.addEventListener('click', () => { navOverlay.classList.add('open'); });
      navClose.addEventListener('click', () => { navOverlay.classList.remove('open'); });
      navOverlay.addEventListener('click', (e) => { if (e.target === navOverlay) navOverlay.classList.remove('open'); });
    }

    // Data loading from Excel
    async function loadXlsx() {
      const res = await fetch('catalog.xlsx');
      if (!res.ok) throw new Error('Ne mogu da učitam catalog.xlsx');
      const buf = await res.arrayBuffer();
      const wb = XLSX.read(buf, { type: 'array' });
      return {
        PRODUCTS: XLSX.utils.sheet_to_json(wb.Sheets['Products'] || {}, {defval: ''}),
        DIMENSIONS: XLSX.utils.sheet_to_json(wb.Sheets['Dimensions'] || {}, {defval: ''}),
        IMAGES: XLSX.utils.sheet_to_json(wb.Sheets['Images'] || {}, {defval: ''}),
      };
    }

    function minPrice(dims){
      const arr = dims.map(d => Number(d.price_eur || d.price || NaN)).filter(n => isFinite(n));
      return arr.length ? Math.min(...arr) : null;
    }

    function unique(arr) { return [...new Set(arr.filter(Boolean))]; }

    function card(p, price, img){
      const url = 'product.html?id=' + encodeURIComponent(p.id);
      return `<div class="card">
        <a href="${url}">
          <div class="ph">${img ? `<img src="${img}" alt="${p.name||''}" />` : ''}</div>
        </a>
        <div class="body">
          <a href="${url}"><h3>${p.name||''}</h3></a>
          <div class="meta">Boja: ${p.color||'-'} · Obrade: ${p.finishes||'-'}</div>
          <div class="chips">
            <span class="chip">${price!=null ? ('Od ' + price + '€') : 'Cena na upit'}</span>
          </div>
        </div>
      </div>`;
    }

    (async function(){
      const db = await loadXlsx();

      // Build fast lookups
      const imagesByProduct = {};
      db.IMAGES.forEach(i => {
        const k = String(i.product_id || i.productId || '');
        if (!imagesByProduct[k]) imagesByProduct[k] = [];
        imagesByProduct[k].push(i.image_url);
      });
      const dimsByProduct = {};
      db.DIMENSIONS.forEach(d => {
        const k = String(d.product_id || d.productId || '');
        if (!dimsByProduct[k]) dimsByProduct[k] = [];
        dimsByProduct[k].push(d);
      });

      // Populate color/finish filters
      const colors = unique(db.PRODUCTS.map(p=>p.color));
      const finishes = unique(db.PRODUCTS.flatMap(p => (String(p.finishes||'').split(',').map(s=>s.trim()).filter(Boolean))));
      const fColor = document.getElementById('fColor');
      colors.forEach(c => fColor.insertAdjacentHTML('beforeend', `<option value="${c}">${c}</option>`));
      const fFinish = document.getElementById('fFinish');
      finishes.forEach(f => fFinish.insertAdjacentHTML('beforeend', `<option value="${f}">${f}</option>`));

      const grid = document.getElementById('grid');
      const empty = document.getElementById('empty');
      const q = document.getElementById('q');
      const fMin = document.getElementById('fMin');
      const fMax = document.getElementById('fMax');

      function apply(){
        const qv = (q.value||'').toLowerCase();
        const cv = fColor.value;
        const fv = fFinish.value;
        const minv = Number(fMin.value||NaN);
        const maxv = Number(fMax.value||NaN);

        const items = db.PRODUCTS.filter(p => {
          // search
          const txt = (p.name + ' ' + p.description + ' ' + p.color + ' ' + p.finishes).toLowerCase();
          if (qv && !txt.includes(qv)) return false;
          if (cv && p.color !== cv) return false;
          if (fv && !String(p.finishes||'').split(',').map(s=>s.trim()).includes(fv)) return false;
          // price range
          const mp = minPrice(dimsByProduct[String(p.id)] || []);
          if (isFinite(minv) && (mp==null || mp < minv)) return false;
          if (isFinite(maxv) && (mp==null || mp > maxv)) return false;
          return true;
        }).map(p => {
          const pid = String(p.id);
          const img = (imagesByProduct[pid] && imagesByProduct[pid][0]) || p.base_image || '';
          const price = minPrice(dimsByProduct[pid] || []);
          return card(p, price, img);
        });

        grid.innerHTML = items.join('');
        empty.style.display = items.length ? 'none' : 'block';
      }

      q.addEventListener('input', apply);
      fColor.addEventListener('change', apply);
      fFinish.addEventListener('change', apply);
      fMin.addEventListener('input', apply);
      fMax.addEventListener('input', apply);
      document.getElementById('clear').addEventListener('click', () => {
        q.value=''; fColor.value=''; fFinish.value=''; fMin.value=''; fMax.value=''; apply();
      });

      apply();
    })();
  </script>

  <footer class="site-footer">
    <div class="cta">
      <div class="inner">
        <div>
          <h3>Spremni za ponudu?</h3>
          <p>Pošaljite nacrt ili količine — odgovaramo istog dana.</p>
        </div>
        <div class="row"><a class="btn-primary" href="contact.html">Kontakt</a><a class="btn-secondary" href="catalog.xlsx" download>Preuzmi cenovnik</a><a class="btn-primary" href="javascript:void(0)" onclick="openChatWidget()">Postavi pitanje</a></div>
      </div>
    </div>
    <div class="wrap">
      <div class="links">
        <a href="about.html">O nama</a>
        <a href="catalog.html">Katalog</a><a href="blog.html">Blog</a>
        <a href="contact.html">Kontakt</a>
      </div>
      <div class="links" style="justify-content:flex-end;">
        <a href="privacy.html">Politika privatnosti</a>
        <a href="terms.html">Uslovi korišćenja</a>
      </div>
    </div>
    <div class="bottom"><div class="inner"><div>© 2025 Plavi tok</div><div></div></div></div>
  </footer>


    <!-- Chat widget (same behavior as na početnoj) -->
    <div class="chat-widget" id="chatWidget">
        <div class="chat-header">Chat sa Grok-om
            <button onclick="minimizeMaximizeChatWidget()" id="minimizeMaximizeButton">-</button>
            <button onclick="closeChatWidget()">X</button>
        </div>
        <div class="chat-body" id="chatBody"></div>
        <div class="chat-input">
            <input type="text" id="chatInput" placeholder="Postavi pitanje...">
            <button onclick="sendMessage()">Pošalji</button>
        </div>
    </div>
    

    <script>
    /* removed apiKey */
    const endpoint = 'https://api.x.ai/v1/chat/completions';
    let chatOpen = false;
    let isMinimized = false;

    function openChatWidget() {
        const chatWidget = document.getElementById('chatWidget');
        chatOpen = !chatOpen;
        chatWidget.style.display = chatOpen ? 'flex' : 'none';
        if (chatOpen && isMinimized) {
            minimizeMaximizeChatWidget();
        }
    }
    function closeChatWidget() {
        document.getElementById('chatWidget').style.display = 'none';
        chatOpen = false;
    }
    function minimizeMaximizeChatWidget() {
        const chatBody = document.getElementById('chatBody');
        const chatInput = document.querySelector('.chat-input');
        const minimizeMaximizeButton = document.getElementById('minimizeMaximizeButton');
        if (!isMinimized) {
            chatBody.style.display = 'none';
            chatInput.style.display = 'none';
            document.getElementById('chatWidget').style.height = '50px';
            minimizeMaximizeButton.textContent = '+';
            isMinimized = true;
        } else {
            chatBody.style.display = 'block';
            chatInput.style.display = 'flex';
            document.getElementById('chatWidget').style.height = '400px';
            minimizeMaximizeButton.textContent = '-';
            isMinimized = false;
        }
    }
    async function sendMessage() {
        const input = document.getElementById('chatInput');
        const userMessage = input.value.trim();
        if (userMessage) {
            addMessage('user', userMessage);
            input.value = '';
            try {
                const response = await fetch(endpoint, {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${apiKey}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        model: 'grok-4-latest',
                        messages: [
                            { role: 'system', content: 'You are a helpful assistant for Balkan Mining - Mermer Invest.' },
                            { role: 'user', content: userMessage }
                        ],
                        stream: false,
                        temperature: 0
                    })
                });
                const data = await response.json();
                if (response.ok) {
                    addMessage('bot', data.choices[0].message.content || 'Nema odgovora.');
                } else {
                    addMessage('bot', 'Greška: ' + (data.error?.message || 'Server problem'));
                }
            } catch (error) {
                addMessage('bot', 'Greška u konekciji: ' + error.message);
            }
        }
    }
    function addMessage(sender, message) {
        const chatBody = document.getElementById('chatBody');
        const wrap = document.createElement('div');
        wrap.classList.add('message', sender);
        const bubble = document.createElement('div');
        bubble.classList.add('bubble');
        bubble.textContent = message;
        wrap.appendChild(bubble);
        chatBody.appendChild(wrap);
        chatBody.scrollTop = chatBody.scrollHeight;
    }
    </script>

<!-- XAPI Chat + Nav bootstrap (non-intrusive, no keys in front) -->
<script>
(function(){
  const $ = (s, root=document)=>root.querySelector(s);
  const $$ = (s, root=document)=>Array.from(root.querySelectorAll(s));
  const endpoint = '/sajt/xapi/chat.php';

  function ensureHamburger(){
    const hamb = $('.hamburger');
    const menu = $('.nav-menu');
    const close = $('.close-btn');
    if (hamb && menu){ hamb.addEventListener('click', ()=> menu.classList.add('active')); }
    if (close && menu){ close.addEventListener('click', ()=> menu.classList.remove('active')); }
  }

  function getChatParts(){
    const panel = $('.chat-widget') || $('#chatWidget') || $('.chat-panel') || $('.chat-container');
    const body  = $('.chat-body') || $('.chat-messages') || $('#chatMessages') || panel;
    const input = $('#chatInput') || (panel && panel.querySelector('.chat-input input')) || $('input#chat') || $('input[name=chat]');
    const send  = $('#chatSend') || (panel && panel.querySelector('.chat-input button')) || $('button.send') || $('button#sendMessage');
    return {panel, body, input, send};
  }

  function openChat(){
    const {panel} = getChatParts();
    if (!panel) return;
    if (getComputedStyle(panel).display === 'none') {
      panel.style.display = (panel.classList.contains('chat-widget') ? 'flex' : 'block');
    }
    panel.classList.add('open');
  }
  function closeChat(){
    const {panel} = getChatParts();
    if (!panel) return;
    panel.classList.remove('open');
    if (panel.classList.contains('chat-widget')) panel.style.display = 'none';
  }
  window.openChat = openChat;

  function wireOpeners(){
    const openers = $$('[data-open-chat], .chat-button, .open-chat, #openChat, a.chat-button, button.chat-button');
    openers.forEach(el => el.addEventListener('click', (e)=>{ e.preventDefault(); openChat(); }));
    const closer = $('.chat-close, #chatClose, .chat-header button.close, .chat-header .close-btn');
    if (closer) closer.addEventListener('click', (e)=>{ e.preventDefault(); closeChat(); });
  }

  function addMessage(role, text){
    const {body} = getChatParts();
    if (!body) return;
    const row = document.createElement('div');
    row.className = 'msg ' + role;
    row.textContent = String(text ?? '');
    body.appendChild(row);
    body.scrollTop = body.scrollHeight;
  }
  window.addMessage = window.addMessage || addMessage;

  async function sendMessage(){
    const {input} = getChatParts();
    if (!input) return;
    const msg = (input.value || '').trim();
    if (!msg) return;
    addMessage('user', msg);
    input.value='';
    try{
      const res = await fetch(endpoint, {
        method:'POST',
        headers:{'Content-Type':'application/json'},
        body: JSON.stringify({ message: msg })
      });
      let text = '';
      try {
        const data = await res.json();
        text = data?.reply || data?.message || data?.choices?.[0]?.message?.content || JSON.stringify(data);
      } catch(_) {
        text = await res.text();
      }
      addMessage('bot', text || 'Prazan odgovor.');
    }catch(err){
      console.error(err);
      addMessage('bot','Greška: server nije dostupan.');
    }
  }
  window.sendMessage = window.sendMessage || sendMessage;

  function wireSenders(){
    const {input, send} = getChatParts();
    const form = (input && input.closest('form'));
    if (send) send.addEventListener('click', (e)=>{ e.preventDefault(); sendMessage(); });
    if (input) input.addEventListener('keydown', (e)=>{ if(e.key==='Enter'){ e.preventDefault(); sendMessage(); } });
    if (form) form.addEventListener('submit', (e)=>{ e.preventDefault(); sendMessage(); });
  }

  document.addEventListener('DOMContentLoaded', function(){
    ensureHamburger();
    wireOpeners();
    wireSenders();
  });
})();
</script>


<!-- MINIMAL PATCH: keep layout; proxy any model fetch to /sajt/xapi/chat.php -->
<script>
(function(){
  try {
    // Avoid ReferenceError in legacy code
    if (typeof window.apiKey === 'undefined') {
      window.apiKey = 'proxied';
    }

    const ORIG_FETCH = window.fetch.bind(window);
    window.fetch = async function(input, init){
      try{
        const url = (typeof input === 'string') ? input : (input && input.url) || '';
        const isModelApi = /api\.x\.ai|openai|anthropic|groq/i.test(url);
        if (!isModelApi) {
          return ORIG_FETCH(input, init);
        }

        // Try to extract user's message from the original body if present
        let userMsg = '';
        try {
          const bodyStr = init && init.body ? (typeof init.body === 'string' ? init.body : JSON.stringify(init.body)) : '';
          if (bodyStr) {
            const payload = JSON.parse(bodyStr);
            userMsg = payload?.message 
                   || payload?.prompt 
                   || (Array.isArray(payload?.messages) ? (payload.messages.at(-1)?.content || '') : '');
          }
        } catch(e){ /* ignore parse errors */ }

        const resp = await ORIG_FETCH('/sajt/xapi/chat.php', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ message: userMsg || '' })
        });
        return resp;
      }catch(err){
        // Fallback to original fetch if anything goes wrong
        return ORIG_FETCH(input, init);
      }
    };
  } catch(e) {
    console.error('Proxy bootstrap error:', e);
  }
})();
</script>

</body>
</html>
