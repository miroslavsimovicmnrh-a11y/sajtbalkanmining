<!DOCTYPE html>
<html lang="sr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Vesti i saopštenja – Balkan Mining · Mermer Invest</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;500;600;700;800&family=Playfair+Display:wght@600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
    <style>
        :root {
            --bg: #0e141f;
            --surface: rgba(14, 22, 35, 0.86);
            --surface-strong: rgba(18, 28, 41, 0.94);
            --text: #f8fafc;
            --muted: #9aa5b5;
            --accent: #d4a017;
            --accent-soft: #f1c96b;
            --line: rgba(148, 163, 184, 0.18);
            --radius-lg: 28px;
            --radius-md: 18px;
            --radius-sm: 12px;
            --shadow-lg: 0 32px 90px rgba(4, 9, 20, 0.55);
            --shadow-card: 0 18px 40px rgba(6, 11, 22, 0.45);
            --font-sans: 'Montserrat', 'Inter', sans-serif;
            --font-display: 'Playfair Display', 'Times New Roman', serif;
        }

        *, *::before, *::after { box-sizing: border-box; }
        html { scroll-behavior: smooth; }
        body {
            margin: 0;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            font-family: var(--font-sans);
            background: radial-gradient(circle at top, rgba(28, 46, 70, 0.35), transparent 60%), var(--bg);
            color: var(--text);
            line-height: 1.6;
        }
        main { flex: 1; }
        img { max-width: 100%; display: block; }
        a { color: inherit; text-decoration: none; }
        ul { list-style: none; margin: 0; padding: 0; }
        h1, h2, h3 { margin: 0; line-height: 1.2; }
        h1 { font-family: var(--font-display); font-size: clamp(2.5rem, 5vw, 3.6rem); letter-spacing: -0.02em; }
        h2 { font-family: var(--font-display); font-size: clamp(2rem, 4vw, 3rem); }
        h3 { font-size: clamp(1.1rem, 2.5vw, 1.5rem); font-weight: 700; }
        p { margin: 0; color: var(--muted); }
        .container { width: min(1180px, calc(100% - 48px)); margin: 0 auto; }
        .eyebrow { display: inline-flex; align-items: center; gap: 0.4rem; font-size: 0.75rem; font-weight: 700; letter-spacing: 0.4em; text-transform: uppercase; color: var(--accent-soft); }
        .eyebrow::before { content: ''; width: 28px; height: 1px; background: var(--accent-soft); opacity: 0.8; }

        .site-header { position: relative; z-index: 40; }
        .nav {
            position: fixed;
            top: 28px;
            left: 50%;
            transform: translateX(-50%);
            width: min(1120px, calc(100% - 32px));
            padding: 14px 22px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 18px;
            background: linear-gradient(140deg, rgba(17, 27, 42, 0.92), rgba(12, 19, 30, 0.78));
            border: 1px solid var(--line);
            border-radius: var(--radius-lg);
            box-shadow: var(--shadow-card);
            backdrop-filter: blur(18px);
        }
        .nav-left { display: flex; align-items: center; gap: 16px; }
        .nav-left a { display: inline-flex; align-items: center; background: rgba(255,255,255,0.04); padding: 6px 10px; border-radius: 14px; border: 1px solid rgba(148,163,184,0.18); }
        .nav-left img { height: 58px; width: auto; }
        .nav-tagline { font-size: 0.72rem; letter-spacing: 0.38em; text-transform: uppercase; color: var(--muted); font-weight: 600; }
        .nav-right { display: flex; align-items: center; gap: 18px; }
        .nav-inline { display: none; align-items: center; gap: 22px; font-size: 0.8rem; font-weight: 600; text-transform: uppercase; letter-spacing: 0.18em; }
        .nav-inline a { color: var(--muted); padding-bottom: 6px; border-bottom: 2px solid transparent; transition: color .3s ease, border-color .3s ease; }
        .nav-inline a:hover, .nav-inline a:focus-visible { color: var(--text); border-bottom-color: var(--accent); }
        .nav-inline .nav-cta { color: var(--accent-soft); }
        .nav-burger { width: 50px; height: 50px; border-radius: 16px; border: 1px solid rgba(148,163,184,0.22); background: rgba(255,255,255,0.06); display: grid; place-items: center; cursor: pointer; }
        .nav-burger span { display: block; width: 22px; height: 2px; background: #fff; margin: 3px 0; }
        .nav-overlay { position: fixed; inset: 0; background: rgba(5,9,18,0.92); display: none; z-index: 60; align-items: center; justify-content: center; backdrop-filter: blur(12px); }
        .nav-overlay.open { display: flex; }
        .nav-close { position: absolute; top: 28px; right: 40px; width: 54px; height: 54px; border-radius: 18px; border: 1px solid rgba(148,163,184,0.3); background: rgba(255,255,255,0.1); font-size: 28px; color: #fff; cursor: pointer; }
        .nav-links { display: flex; flex-direction: column; gap: 18px; align-items: center; }
        .nav-links a { font-size: 2rem; font-weight: 700; letter-spacing: 0.08em; color: #fff; }
        .nav-links a:hover { color: var(--accent-soft); }
        @media (min-width:900px){ .nav-inline{display:flex;} .nav-burger{display:none;} }
        @media (max-width:640px){ .nav{width:calc(100% - 24px); padding:12px 16px;} .nav-left img{height:48px;} .nav-tagline{display:none;} }

        .btn { display:inline-flex; align-items:center; justify-content:center; gap:0.5rem; padding:0.95rem 1.8rem; border-radius:999px; border:1px solid transparent; font-size:0.82rem; font-weight:700; text-transform:uppercase; letter-spacing:0.22em; transition:transform .3s ease, background .3s ease, color .3s ease, box-shadow .3s ease; }
        .btn:hover,.btn:focus-visible{ transform:translateY(-3px); }
        .btn-primary{ background:linear-gradient(135deg,#f8e29c,#d4a017); color:#1d1b14; box-shadow:0 18px 32px rgba(212,160,23,0.35); }
        .btn-light{ background:rgba(255,255,255,0.12); color:var(--text); border:1px solid rgba(255,255,255,0.22); }
        .btn-ghost{ background:rgba(255,255,255,0.04); color:var(--text); border:1px solid rgba(148,163,184,0.18); }
        .btn-light:hover,.btn-light:focus-visible{ background:rgba(255,255,255,0.2); }
        .btn-ghost:hover,.btn-ghost:focus-visible{ background:rgba(148,163,184,0.12); }
        .btn + .btn { margin-left: 0.5rem; }

        .page-hero { padding: clamp(6rem, 12vw, 8rem) 0 clamp(3rem, 8vw, 5rem); position: relative; overflow: hidden; }
        .page-hero::after { content:''; position:absolute; inset:0; background: radial-gradient(circle at top right, rgba(212,160,23,0.18), transparent 55%); }
        .page-hero > .container { position: relative; z-index: 1; }
        .hero-grid { display: grid; gap: 3rem; align-items: center; }
        @media (min-width: 960px){ .hero-grid { grid-template-columns: minmax(0,1.1fr) minmax(0,0.9fr); } }
        .hero-intro { display: grid; gap: 1.2rem; }
        .hero-actions { display:flex; flex-wrap:wrap; gap:0.75rem; margin-top:1.6rem; }
        .hero-note { display:flex; gap:1rem; align-items:center; margin-top:1.4rem; padding:1rem 1.4rem; border-radius:var(--radius-md); border:1px solid var(--line); background:rgba(148,163,184,0.08); color:var(--muted); }
        .hero-note i { color: var(--accent-soft); }
        .hero-stats { display:grid; gap:1rem; grid-template-columns: repeat(auto-fit, minmax(200px,1fr)); }
        .stat-card { background: var(--surface); border-radius: var(--radius-lg); border:1px solid var(--line); padding:1.8rem; box-shadow:var(--shadow-card); display:flex; flex-direction:column; gap:0.6rem; }
        .stat-card span { font-size:0.75rem; letter-spacing:0.28em; text-transform:uppercase; color:var(--accent-soft); }
        .stat-card strong { font-size: clamp(1.8rem, 4vw, 2.6rem); font-weight:800; color:#fff; }

        .section { padding: clamp(4rem, 10vw, 6.5rem) 0; }
        .filter-card { background: var(--surface); border-radius: var(--radius-lg); border:1px solid var(--line); box-shadow: var(--shadow-card); padding: clamp(2rem, 5vw, 2.6rem); display:grid; gap:1.6rem; }
        .filter-top { display:flex; flex-wrap:wrap; gap:1rem; justify-content:space-between; align-items:flex-end; }
        .result-count { font-size:0.78rem; text-transform:uppercase; letter-spacing:0.24em; color:var(--muted); }
        .filter-grid { display:grid; gap:1rem; grid-template-columns: repeat(auto-fit, minmax(220px, 1fr)); }
        .filter-field { display:grid; gap:0.45rem; }
        .filter-field span { font-size:0.75rem; letter-spacing:0.18em; text-transform:uppercase; color:var(--muted); }
        .filter-field input, .filter-field select { border-radius: var(--radius-sm); border:1px solid rgba(148,163,184,0.26); background:rgba(5,10,18,0.45); color:#fff; padding:0.85rem 1rem; font-family:var(--font-sans); }
        .filter-field input:focus, .filter-field select:focus { outline:none; border-color:rgba(212,160,23,0.5); box-shadow:0 0 0 3px rgba(212,160,23,0.16); }

        .blog-layout { display:grid; gap:2.4rem; margin-top:2.8rem; }
        @media (min-width:1080px){ .blog-layout { grid-template-columns: minmax(0,1.6fr) minmax(0,0.8fr); } }
        .articles-list { display:grid; gap:1.6rem; }
        .article-card { background: var(--surface); border-radius: var(--radius-lg); border:1px solid var(--line); box-shadow: var(--shadow-card); overflow:hidden; display:grid; }
        .article-thumb { position:relative; padding-top: 56%; background: rgba(148,163,184,0.12); overflow:hidden; }
        .article-thumb img { position:absolute; inset:0; width:100%; height:100%; object-fit:cover; transition: transform .4s ease; }
        .article-thumb:hover img { transform: scale(1.05); }
        .article-body { padding:1.8rem; display:grid; gap:0.8rem; }
        .article-body h3 { font-size:1.3rem; color:#fff; }
        .article-body p { font-size:0.95rem; color:var(--muted); }
        .article-meta { display:flex; gap:0.8rem; flex-wrap:wrap; font-size:0.75rem; letter-spacing:0.18em; text-transform:uppercase; color:var(--muted); }
        .tag-pill { display:inline-flex; align-items:center; gap:0.35rem; padding:0.45rem 0.85rem; border-radius:999px; border:1px solid rgba(212,160,23,0.32); background:rgba(212,160,23,0.16); color:var(--accent-soft); font-size:0.72rem; text-transform:uppercase; letter-spacing:0.18em; }

        .sidebar { display:grid; gap:1.4rem; }
        .sidebar-card { background: var(--surface); border-radius: var(--radius-lg); border:1px solid var(--line); box-shadow: var(--shadow-card); padding:1.8rem; display:grid; gap:1rem; }
        .popular-item { display:grid; gap:0.35rem; padding-bottom:0.9rem; border-bottom:1px solid rgba(148,163,184,0.16); }
        .popular-item:last-child { border-bottom:none; padding-bottom:0; }
        .popular-item a { font-weight:600; color:#fff; }
        .popular-item span { font-size:0.75rem; color:var(--muted); }
        .tags-cloud { display:flex; flex-wrap:wrap; gap:0.6rem; }
        .tags-cloud button { padding:0.55rem 0.95rem; border-radius:999px; border:1px solid rgba(148,163,184,0.24); background:rgba(148,163,184,0.08); color:var(--muted); font-size:0.75rem; letter-spacing:0.18em; text-transform:uppercase; cursor:pointer; transition: background .3s ease, border-color .3s ease; }
        .tags-cloud button:hover { background:rgba(212,160,23,0.18); border-color:rgba(212,160,23,0.4); color:var(--accent-soft); }

        .pagination { display:flex; gap:0.6rem; justify-content:center; margin-top:2.2rem; flex-wrap:wrap; }
        .pagination button { padding:0.6rem 1rem; border-radius:12px; border:1px solid rgba(148,163,184,0.24); background:rgba(148,163,184,0.08); color:#fff; cursor:pointer; transition: background .3s ease, border-color .3s ease; }
        .pagination button.active { background:rgba(212,160,23,0.18); border-color:rgba(212,160,23,0.45); color:var(--accent-soft); }

        .empty-state { margin-top:2.6rem; text-align:center; padding:2rem; border-radius:var(--radius-lg); border:1px solid var(--line); background:rgba(148,163,184,0.1); color:var(--muted); display:none; }

        footer { padding:1.8rem; text-align:center; font-size:0.85rem; color:var(--muted); border-top:1px solid rgba(148,163,184,0.12); background:rgba(5,10,18,0.65); }
        footer a { color:var(--accent-soft); }

        .social-icons { position:fixed; left:28px; bottom:28px; display:flex; flex-direction:column; gap:12px; z-index:30; }
        .social-icons a { width:42px; height:42px; border-radius:14px; background:rgba(17,27,42,0.88); border:1px solid rgba(148,163,184,0.18); display:grid; place-items:center; color:var(--muted); transition: transform .3s ease, color .3s ease, border-color .3s ease; }
        .social-icons a:hover { transform:translateY(-4px); color:var(--accent-soft); border-color:rgba(212,160,23,0.45); }
        @media (max-width:720px){ .hero-actions{flex-direction:column; align-items:stretch;} .social-icons{left:16px; bottom:18px;} .social-icons a{width:36px; height:36px;} }

        .chat-widget { position:fixed; bottom:24px; right:24px; width:320px; height:430px; background:rgba(11,18,29,0.94); border-radius:24px; border:1px solid rgba(148,163,184,0.22); box-shadow:var(--shadow-lg); display:none; flex-direction:column; overflow:hidden; backdrop-filter:blur(18px); z-index:80; }
        .chat-header { padding:1rem 1.4rem; display:flex; align-items:center; justify-content:space-between; background:rgba(17,27,42,0.88); color:#fff; font-weight:600; }
        .chat-header button { background:rgba(255,255,255,0.08); border:1px solid rgba(148,163,184,0.18); border-radius:999px; width:34px; height:34px; color:#fff; cursor:pointer; }
        .chat-body { flex:1; padding:1.1rem; display:flex; flex-direction:column; gap:0.8rem; overflow-y:auto; }
        .message { display:flex; }
        .message .bubble { padding:0.85rem 1.1rem; border-radius:18px; border:1px solid rgba(148,163,184,0.2); background:rgba(255,255,255,0.06); color:var(--text); font-size:0.88rem; line-height:1.4; max-width:80%; }
        .message.user { justify-content:flex-end; }
        .message.user .bubble { background:rgba(212,160,23,0.2); color:var(--accent-soft); border-color:rgba(212,160,23,0.35); }
        .chat-input { padding:1rem; display:flex; gap:0.6rem; border-top:1px solid rgba(148,163,184,0.18); background:rgba(11,18,29,0.88); }
        .chat-input input { flex:1; padding:0.75rem 1rem; border-radius:14px; border:1px solid rgba(148,163,184,0.26); background:rgba(4,9,18,0.4); color:#fff; }
        .chat-input button { padding:0.75rem 1.4rem; border-radius:14px; border:none; font-weight:600; background:linear-gradient(135deg,#f8e29c,#d4a017); color:#1d1b14; cursor:pointer; }
        @media (max-width:520px){ .chat-widget{width:calc(100% - 32px); right:16px; bottom:16px;} }
    </style>
</head>
<body>
    <header class="site-header">
        <div class="nav">
            <div class="nav-left">
                <a href="https://ibb.co/QGRBCQd" aria-label="Balkan Mining logo"><img src="https://i.ibb.co/8Vp3dsc/Screenshot-1.png" alt="Balkan Mining logo"></a>
                <span class="nav-tagline">Mermer Invest</span>
            </div>
            <div class="nav-right">
                <nav class="nav-inline" aria-label="Glavna navigacija">
                    <a href="index.html">Početna</a>
                    <a href="about.html">O nama</a>
                    <a href="catalog.html" class="nav-cta">Katalog</a>
                    <a href="blog.html">Blog</a>
                    <a href="contact.html">Kontakt</a>
                </nav>
                <button class="nav-burger" id="navBurger" aria-label="Otvori meni"><span></span><span></span><span></span></button>
            </div>
        </div>
    </header>
    <div class="nav-overlay" id="navOverlay">
        <button class="nav-close" id="navClose" aria-label="Zatvori meni">×</button>
        <nav class="nav-links" aria-label="Meni">
            <a href="index.html">Početna</a>
            <a href="about.html">O nama</a>
            <a href="catalog.html">Katalog</a>
            <a href="blog.html">Blog</a>
            <a href="contact.html">Kontakt</a>
        </nav>
    </div>

    <main>
        <section class="page-hero blog-hero">
            <div class="container">
                <div class="hero-grid">
                    <div class="hero-intro">
                        <span class="eyebrow">Novosti</span>
                        <h1>Vesti, reference i najave iz Balkan Mining tima</h1>
                        <p>Pratite razvoj projekata sa mermerom Plavi tok, logističke inovacije i partnerske priče sa gradilišta širom sveta.</p>
                        <div class="hero-actions">
                            <a href="contact.html" class="btn btn-primary">Pišite PR timu</a>
                            <button type="button" class="btn btn-ghost" onclick="openChatWidget()"><i class="fa-solid fa-comment"></i> Postavite pitanje</button>
                        </div>
                        <div class="hero-note"><i class="fa-solid fa-bell"></i><p>Newsletter izlazi svakog prvog petka u mesecu. Prijavite se putem kontakt forme.</p></div>
                    </div>
                    <div class="hero-stats">
                        <article class="stat-card">
                            <span>Ukupno objava</span>
                            <strong id="blogTotalPosts">—</strong>
                            <p>Sažeci projekata, logističke studije i intervjui sa partnerima.</p>
                        </article>
                        <article class="stat-card">
                            <span>Aktuelni projekti</span>
                            <strong>12</strong>
                            <p>Trenutno koordinisane isporuke mermera za hotele, wellness centre i javne zgrade.</p>
                        </article>
                        <article class="stat-card">
                            <span>Godina osnivanja</span>
                            <strong>2000</strong>
                            <p>Više od dve decenije iskustva u eksploataciji i obradi mermera Plavi tok.</p>
                        </article>
                    </div>
                </div>
            </div>
        </section>

        <section class="section">
            <div class="container">
                <div class="filter-card">
                    <div class="filter-top">
                        <div>
                            <span class="eyebrow">Filtriraj</span>
                            <h2>Pronađite relevantne priče</h2>
                        </div>
                        <span class="result-count" id="blogResultsCount">0 objava</span>
                    </div>
                    <div class="filter-grid">
                        <label class="filter-field">
                            <span>Pretraga</span>
                            <input type="search" id="search" placeholder="Naslov, tag, autor...">
                        </label>
                        <label class="filter-field">
                            <span>Tag</span>
                            <select id="tagFilter">
                                <option value="">Svi tagovi</option>
                            </select>
                        </label>
                        <label class="filter-field">
                            <span>Godina</span>
                            <select id="yearFilter">
                                <option value="">Sve godine</option>
                            </select>
                        </label>
                        <div class="filter-field">
                            <span>&nbsp;</span>
                            <button type="button" class="btn btn-ghost" id="clearFilters">Resetuj filtere</button>
                        </div>
                    </div>
                </div>

                <div class="blog-layout">
                    <div>
                        <div class="articles-list" id="articlesList"></div>
                        <div class="empty-state" id="emptyBlog">Nema objava koje odgovaraju zadatim filterima. Pokušajte sa drugim kriterijumima.</div>
                        <div class="pagination" id="pagination"></div>
                    </div>
                    <aside class="sidebar">
                        <div class="sidebar-card">
                            <h3>Najčitanije priče</h3>
                            <div id="popularList"></div>
                        </div>
                        <div class="sidebar-card">
                            <h3>Tagovi</h3>
                            <div id="tagsCloud" class="tags-cloud"></div>
                        </div>
                    </aside>
                </div>
            </div>
        </section>
    </main>

    <footer>
        © <span id="currentYear"></span> Balkan Mining – Mermer Invest. <a href="mailto:office@balkanmining.rs">office@balkanmining.rs</a>
    </footer>

    <div class="social-icons" aria-label="Društvene mreže">
        <a href="#" aria-label="Instagram"><i class="fab fa-instagram"></i></a>
        <a href="#" aria-label="Facebook"><i class="fab fa-facebook-f"></i></a>
        <a href="#" aria-label="TikTok"><i class="fab fa-tiktok"></i></a>
        <a href="#" aria-label="YouTube"><i class="fab fa-youtube"></i></a>
        <a href="#" aria-label="X"><i class="fab fa-x-twitter"></i></a>
        <a href="#" aria-label="WhatsApp"><i class="fab fa-whatsapp"></i></a>
    </div>

    <div class="chat-widget" id="chatWidget">
        <div class="chat-header">Chat sa Grok-om
            <div>
                <button onclick="minimizeMaximizeChatWidget()" id="minimizeMaximizeButton" aria-label="Minimizuj chat">-</button>
                <button onclick="closeChatWidget()" aria-label="Zatvori chat">×</button>
            </div>
        </div>
        <div class="chat-body" id="chatBody"></div>
        <div class="chat-input">
            <input type="text" id="chatInput" placeholder="Postavi pitanje...">
            <button onclick="sendMessage()">Pošalji</button>
        </div>
    </div>

    <script>
        const apiKey = window.GROK_API_KEY || '';
        const endpoint = 'https://api.x.ai/v1/chat/completions';
        let chatOpen = false;
        let isMinimized = false;

        const navBurger = document.getElementById('navBurger');
        const navOverlay = document.getElementById('navOverlay');
        const navClose = document.getElementById('navClose');

        if (navBurger && navOverlay && navClose) {
            navBurger.addEventListener('click', () => navOverlay.classList.add('open'));
            navClose.addEventListener('click', () => navOverlay.classList.remove('open'));
            navOverlay.addEventListener('click', e => { if (e.target === navOverlay) navOverlay.classList.remove('open'); });
        }

        function openChatWidget() {
            const chatWidget = document.getElementById('chatWidget');
            chatOpen = !chatOpen;
            chatWidget.style.display = chatOpen ? 'flex' : 'none';
            if (chatOpen && isMinimized) minimizeMaximizeChatWidget();
        }

        function closeChatWidget() {
            document.getElementById('chatWidget').style.display = 'none';
            chatOpen = false;
        }

        function minimizeMaximizeChatWidget() {
            const chatBody = document.getElementById('chatBody');
            const chatInput = document.querySelector('.chat-input');
            const toggle = document.getElementById('minimizeMaximizeButton');
            if (!isMinimized) {
                chatBody.style.display = 'none';
                chatInput.style.display = 'none';
                document.getElementById('chatWidget').style.height = '60px';
                toggle.textContent = '+';
                isMinimized = true;
            } else {
                chatBody.style.display = 'flex';
                chatInput.style.display = 'flex';
                document.getElementById('chatWidget').style.height = '430px';
                toggle.textContent = '-';
                isMinimized = false;
            }
        }

        async function sendMessage() {
            const input = document.getElementById('chatInput');
            const userMessage = input.value.trim();
            if (!userMessage) return;
            addMessage('user', userMessage);
            input.value = '';

            if (!apiKey) {
                addMessage('bot', 'Chat asistencija trenutno nije aktivna. Molimo kontaktirajte nas putem forme ili telefona.');
                return;
            }

            try {
                const response = await fetch(endpoint, {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${apiKey}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        model: 'grok-4-latest',
                        messages: [
                            { role: 'system', content: 'You are a helpful assistant for Balkan Mining - Mermer Invest.' },
                            { role: 'user', content: userMessage }
                        ],
                        stream: false,
                        temperature: 0
                    })
                });
                const data = await response.json();
                if (response.ok) {
                    addMessage('bot', data.choices[0].message.content || 'Nema odgovora.');
                } else {
                    addMessage('bot', 'Greška: ' + (data.error?.message || 'Server problem'));
                }
            } catch (error) {
                addMessage('bot', 'Greška u konekciji: ' + error.message);
            }
        }

        function addMessage(sender, message) {
            const chatBody = document.getElementById('chatBody');
            const wrap = document.createElement('div');
            wrap.classList.add('message', sender);
            const bubble = document.createElement('div');
            bubble.classList.add('bubble');
            bubble.textContent = message;
            wrap.appendChild(bubble);
            chatBody.appendChild(wrap);
            chatBody.scrollTop = chatBody.scrollHeight;
        }

        document.getElementById('currentYear').textContent = new Date().getFullYear();
    </script>

    <script>
        const EXCEL_FILE = 'news.xlsx';
        const PAGE_SIZE = 6;
        let ALL = [];
        let FILTERED = [];
        let PAGE = 1;

        const listEl = document.getElementById('articlesList');
        const paginationEl = document.getElementById('pagination');
        const popularEl = document.getElementById('popularList');
        const tagsCloudEl = document.getElementById('tagsCloud');
        const emptyEl = document.getElementById('emptyBlog');
        const resultsCountEl = document.getElementById('blogResultsCount');
        const totalPostsEl = document.getElementById('blogTotalPosts');

        function slugify(s){
            return String(s || '').toLowerCase().normalize('NFD').replace(/[\u0300-\u036f]/g,'').replace(/[^a-z0-9]+/g,'-').replace(/(^-|-$)/g,'');
        }
        function fmtDate(d){
            try {
                const x = new Date(d);
                return x.toLocaleDateString('sr-RS', { day:'2-digit', month:'2-digit', year:'numeric' });
            } catch {
                return d;
            }
        }
        function truncate(text, max = 160){
            const clean = String(text || '').replace(/\s+/g, ' ').trim();
            return clean.length > max ? clean.slice(0, max - 1) + '…' : clean;
        }

        function renderArticles(){
            listEl.innerHTML = '';
            paginationEl.innerHTML = '';
            emptyEl.style.display = FILTERED.length ? 'none' : 'block';
            resultsCountEl.textContent = FILTERED.length === 1 ? '1 objava' : `${FILTERED.length} objava`;
            const start = (PAGE - 1) * PAGE_SIZE;
            const pageItems = FILTERED.slice(start, start + PAGE_SIZE);
            pageItems.forEach(item => {
                const tags = (item.tags || '').split(',').map(t => t.trim()).filter(Boolean);
                const card = document.createElement('article');
                card.className = 'article-card';
                card.innerHTML = `
                    <a class="article-thumb" href="post.html?slug=${encodeURIComponent(item.slug)}">
                        ${item.hero_image ? `<img src="${item.hero_image}" alt="${item.title}">` : ''}
                    </a>
                    <div class="article-body">
                        <div class="article-meta">
                            <span>${fmtDate(item.date)}</span>
                            <span>•</span>
                            <span>${item.author || 'Balkan Mining'}</span>
                        </div>
                        <h3><a href="post.html?slug=${encodeURIComponent(item.slug)}">${item.title}</a></h3>
                        <p>${truncate(item.summary || item.subtitle || item.body_html)}</p>
                        <div class="article-meta">
                            ${tags.map(t => `<span class="tag-pill">${t}</span>`).join(' ')}
                        </div>
                    </div>
                `;
                listEl.appendChild(card);
            });

            const totalPages = Math.ceil(FILTERED.length / PAGE_SIZE) || 1;
            for (let i = 1; i <= totalPages; i++) {
                const btn = document.createElement('button');
                btn.textContent = i;
                if (i === PAGE) btn.classList.add('active');
                btn.addEventListener('click', () => {
                    PAGE = i;
                    renderArticles();
                    window.scrollTo({ top: 0, behavior: 'smooth' });
                });
                paginationEl.appendChild(btn);
            }
        }

        function applyFilters(){
            const query = document.getElementById('search').value.toLowerCase().trim();
            const tag = document.getElementById('tagFilter').value;
            const year = document.getElementById('yearFilter').value;
            FILTERED = ALL.filter(item => {
                const text = [item.title, item.subtitle, item.summary, item.author, item.tags].join(' ').toLowerCase();
                const matchesQuery = !query || text.includes(query);
                const tags = (item.tags || '').split(',').map(t => t.trim());
                const matchesTag = !tag || tags.includes(tag);
                const matchesYear = !year || (new Date(item.date).getFullYear() + '' === year);
                return matchesQuery && matchesTag && matchesYear;
            }).sort((a,b) => new Date(b.date) - new Date(a.date));
            PAGE = 1;
            renderArticles();
        }

        function fillFilters(){
            const tagSelect = document.getElementById('tagFilter');
            const yearSelect = document.getElementById('yearFilter');
            const tags = new Set();
            const years = new Set();
            ALL.forEach(item => {
                (item.tags || '').split(',').map(t => t.trim()).filter(Boolean).forEach(t => tags.add(t));
                const year = new Date(item.date).getFullYear();
                if (!isNaN(year)) years.add(year);
            });
            [...tags].sort().forEach(tag => tagSelect.insertAdjacentHTML('beforeend', `<option value="${tag}">${tag}</option>`));
            [...years].sort((a,b) => b-a).forEach(year => yearSelect.insertAdjacentHTML('beforeend', `<option value="${year}">${year}</option>`));
        }

        function renderPopular(){
            popularEl.innerHTML = '';
            const top = [...ALL].sort((a,b) => (Number(b.views||0) - Number(a.views||0))).slice(0,4);
            top.forEach(item => {
                const row = document.createElement('div');
                row.className = 'popular-item';
                row.innerHTML = `
                    <a href="post.html?slug=${encodeURIComponent(item.slug)}">${item.title}</a>
                    <span>${fmtDate(item.date)} · ${item.author || 'Balkan Mining'}</span>
                `;
                popularEl.appendChild(row);
            });
        }

        function renderTagsCloud(){
            tagsCloudEl.innerHTML = '';
            const tags = new Set();
            ALL.forEach(item => {
                (item.tags || '').split(',').map(t => t.trim()).filter(Boolean).forEach(t => tags.add(t));
            });
            [...tags].sort().forEach(tag => {
                const btn = document.createElement('button');
                btn.type = 'button';
                btn.textContent = tag;
                btn.addEventListener('click', () => {
                    document.getElementById('tagFilter').value = tag;
                    applyFilters();
                });
                tagsCloudEl.appendChild(btn);
            });
        }

        async function loadExcel(){
            const res = await fetch(EXCEL_FILE);
            if (!res.ok) throw new Error('Ne mogu da učitam news.xlsx');
            const buf = await res.arrayBuffer();
            const wb = XLSX.read(buf, { type:'array' });
            const ws = wb.Sheets[wb.SheetNames[0]];
            const rows = XLSX.utils.sheet_to_json(ws, { defval:'' });
            ALL = rows.map(r => ({
                id: r.id || '',
                slug: r.slug || slugify(r.title || r.id || ''),
                title: r.title || '(bez naslova)',
                subtitle: r.subtitle || '',
                author: r.author || 'Balkan Mining',
                date: r.date || new Date().toISOString(),
                tags: r.tags || '',
                hero_image: r.hero_image || '',
                summary: r.summary || '',
                body_html: r.body_html || '',
                views: Number(r.views || 0)
            }));
            totalPostsEl.textContent = ALL.length;
            fillFilters();
            renderPopular();
            renderTagsCloud();
            applyFilters();
        }

        document.getElementById('search').addEventListener('input', () => applyFilters());
        document.getElementById('tagFilter').addEventListener('change', () => applyFilters());
        document.getElementById('yearFilter').addEventListener('change', () => applyFilters());
        document.getElementById('clearFilters').addEventListener('click', () => {
            document.getElementById('search').value = '';
            document.getElementById('tagFilter').value = '';
            document.getElementById('yearFilter').value = '';
            applyFilters();
        });

        loadExcel().catch(err => {
            console.error(err);
            emptyEl.textContent = 'Vesti trenutno nisu dostupne. Pokušajte ponovo ili nas kontaktirajte.';
            emptyEl.style.display = 'block';
        });
    </script>
</body>
</html>
