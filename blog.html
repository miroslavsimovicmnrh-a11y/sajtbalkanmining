<!DOCTYPE html>

<html lang="sr">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<title>BALKAN MINING — Vesti</title>
<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" rel="stylesheet"/>
<script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
<style>
    :root { --bg:#f2f3f5; --paper:#ffffff; --ink:#101214; --muted:#6b7280; --line:#e5e7eb; --accent:#3f3f46; --chip:#f4f4f5; --chip-ink:#0f172a; --radius:14px; }
    * { box-sizing: border-box; font-family: 'Montserrat', system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; }
    body { margin: 0; background: var(--bg); color: var(--ink); }

    /* NAV clone (logo + burger identical positions) */
    .nav-left a { display: inline-block; background: #ffffff; padding: 6px 10px; border-radius: 10px; }
    .nav-left img { height: 64px; width: auto; display: block; }
    @media (max-width: 768px) { .nav-left img { height: 50px; } }
    .nav { position: fixed; top: 28px; left: 40px; right: 40px; z-index: 200; display: flex; align-items: center; justify-content: space-between; pointer-events: none; }
    .nav-left { font-size: 12px; letter-spacing: .18em; text-transform: uppercase; color: #fff; opacity: .9; pointer-events: auto; user-select: none; }
    .nav-burger { width: 54px; height: 54px; border: 0; border-radius: 6px; background: rgba(255,255,255,0.96); display: grid; place-items: center; cursor: pointer; pointer-events: auto; }
    .nav-burger span { display: block; width: 22px; height: 2px; background: #111; margin: 3px 0; transition: transform .25s ease, opacity .25s ease; }
    .nav-overlay { position: fixed; inset: 0; background: rgba(0,0,0,.88); display: none; z-index: 300; }
    .nav-overlay.open { display: flex; }
    .nav-close { position: absolute; top: 28px; right: 40px; width: 54px; height: 54px; border: 0; border-radius: 6px; background: rgba(255,255,255,0.96); font-size: 28px; line-height: 1; cursor: pointer; }
    .nav-links { margin: auto; display: flex; flex-direction: column; gap: 18px; align-items: center; }
    .nav-links a { color: #fff; text-decoration: none; font-size: 28px; font-weight: 700; letter-spacing: .02em; opacity: .95; }
    .nav-links a:hover { opacity: 1; }
    @media (max-width: 768px) {
      .nav { left: 16px; right: 16px; top: 18px; }
      .nav-left { font-size: 10px; letter-spacing: .14em; }
      .nav-burger, .nav-close { width: 46px; height: 46px; }
      .nav-links a { font-size: 22px; }
    }

    /* Social icons (same place/size as on index) */
    .social-icons { 
    position: sticky; 
    bottom: 20px; 
    left: auto;              /* do not rely on left with sticky */
    margin-left: 20px;       /* keeps constant 20px from left edge */
    z-index: 100; 
    display: flex; 
    flex-direction: column; 
    gap: 10px; 
}
    .social-icons a { color: #1c1c1e; font-size: 1.7rem; opacity: 0.9; transition: opacity 0.3s; }
    .social-icons a:hover { opacity: 1; }

    .page { min-height: 100vh; padding-top: 120px; }
    .wrap { max-width: 1280px; margin: 0 auto; padding: 0 20px 80px; }

    .topbar { display: grid; grid-template-columns: 1fr; gap: 14px; margin-top: 40px; margin-bottom: 18px; }
    .filters { display: grid; grid-template-columns: 1.4fr .9fr .9fr .9fr auto; gap: 10px; }
    @media (max-width: 980px){ .filters { display: grid; grid-template-columns: 1.4fr .9fr .9fr .9fr auto; gap: 10px; } }
    .search input, .filters select, .filters input { width: 100%; padding: 12px 12px; border-radius: 10px; border: 1px solid var(--line); background: var(--paper); }
    .btn-clear { padding: 12px 14px; border-radius: 10px; border: 1px solid var(--line); background: var(--paper); cursor: pointer; }

    .grid { display: grid; grid-template-columns: repeat(3, minmax(0,1fr)); gap: 16px; }
    @media (){ .grid { grid-template-columns: repeat(2, minmax(0,1fr)); } }
    @media (max-width: 640px){ .grid { grid-template-columns: 1fr; } }

    .card { background: var(--paper); border-radius: var(--radius); overflow: hidden; box-shadow: 0 2px 10px rgba(0,0,0,.06); display: flex; flex-direction: column; }
    .card a { color: inherit; text-decoration: none; display: block; }
    .card .ph { position: relative; height: 220px; background: #d1d5db; }
    .card .ph img { width: 100%; height: 100%; object-fit: cover; display: block; }
    .card .body { padding: 12px 14px; }
    .card h3 { margin: 0 0 6px; font-size: 18px; }
    .card .meta { color: var(--muted); font-size: 13px; margin-bottom: 8px; }
    .chips { display: flex; flex-wrap: wrap; gap: 8px; }
    .chip { background: var(--chip); color: var(--chip-ink); border-radius: 999px; padding: 6px 10px; font-size: 12px; }

    .empty { color: var(--muted); margin-top: 20px; }

    .footer-spacer { height: 60px; } /* to keep content away from fixed icons */
  
    /* Dark top band behind logo & hamburger */
    .nav-band { position: fixed; top: 0; left: 0; right: 0; height: 120px; background: #1c1c1e; z-index: 120; }
    @media (max-width: 768px){ .nav-band { height: 100px; } }
    /* lift nav above the band */
    .nav { z-index: 200; }

  
    /* Add space below the dark top band */
    .topbar { display: grid; grid-template-columns: 1fr; gap: 14px; margin-top: 40px; margin-bottom: 18px; }
    @media (max-width: 768px){ .topbar { display: grid; grid-template-columns: 1fr; gap: 14px; margin-top: 40px; margin-bottom: 18px; } }

  
    /* ===== Footer V9: CTA Bar Minimal ===== */
    .site-footer { background:#0b0d12; color:#e5e7eb; margin-top:40px; border-top:1px solid #1f2937; }
    .cta { background:linear-gradient(90deg, #111827, #0b0d12); border-bottom:1px solid #1f2937; }
    .cta .inner { max-width:1280px; margin:0 auto; padding:28px 20px; display:flex; justify-content:space-between; align-items:center; gap:16px; flex-wrap:wrap; }
    .cta h3 { margin:0; color:#f9fafb; }
    .cta p { margin:0; color:#9ca3af; }
    .cta .row { display:flex; gap:10px; flex-wrap:wrap; }
    .btn-primary { background:#ffffff; color:#0f1115; border:0; padding:12px 16px; border-radius:10px; font-weight:700; cursor:pointer; text-decoration:none; }
    .btn-secondary { background:#111827; color:#f9fafb; border:1px solid #1f2937; padding:12px 16px; border-radius:10px; font-weight:700; text-decoration:none; }
    .site-footer .wrap { max-width:1280px; margin:0 auto; padding:18px 20px;  grid-template-columns:1fr 1fr; gap:28px; }
    .links { display:flex; gap:18px; flex-wrap:wrap; }
    .links a { color:#e5e7eb; text-decoration:none; opacity:.92; }
    .links a:hover { opacity:1; text-decoration:underline; }
    .bottom { border-top:1px solid #1f2937; }
    .bottom .inner { max-width:1280px; margin:0 auto; padding:14px 20px; display:flex; justify-content:space-between; align-items:center; color:#9ca3af; font-size:13px; }
    @media(max-width:800px){ .wrap{ grid-template-columns:1fr; } }

  
    /* === CHAT WIDGET (copied from homepage) === */
    .chat-widget {
        position: fixed;
        bottom: 20px;
        right: 20px;
        width: 300px;
        height: 400px;
        background-color: white;
        border-radius: 10px;
        box-shadow: 0 0 10px rgba(0, 0, 0, 0.2);
        z-index: 1000;
        display: none;
        flex-direction: column;
    }
    .chat-header {
        background-color: #333;
        color: white;
        padding: 10px;
        border-top-left-radius: 10px;
        border-top-right-radius: 10px;
        text-align: center;
        display: flex;
        justify-content: space-between;
        align-items: center;
    }
    .chat-header button {
        background: none;
        border: none;
        color: white;
        cursor: pointer;
        font-size: 1.2rem;
        margin-left: 10px;
    }
    .chat-body {
        flex: 1;
        padding: 10px;
        overflow-y: auto;
        display: flex;
        flex-direction: column;
        gap: 8px;
    }
    .chat-input {
        display: flex;
        padding: 10px;
        border-top: 1px solid #ccc;
    }
    .chat-input input {
        flex: 1;
        padding: 8px;
        border: 1px solid #ccc;
        border-radius: 5px;
        margin-right: 5px;
    }
    .chat-input button {
        padding: 8px 12px;
        background-color: #d4a017;
        color: white;
        border: none;
        border-radius: 5px;
        cursor: pointer;
    }
    .message { margin-bottom: 0; }
    .message.user { text-align: right; display:flex; justify-content:flex-end; }
    .message.bot { text-align: left; display:flex; justify-content:flex-start; }
    .message .bubble {
        padding: 10px 14px;
        border-radius: 16px;
        max-width: 80%;
        line-height: 1.35;
        word-wrap: break-word;
        white-space: pre-wrap;
        box-shadow: 0 1px 2px rgba(0,0,0,0.08);
    }
    .message.user .bubble { background: #f0f0f0; color: #111; }
    .message.bot .bubble { background: #fff; color: #111; border: 1px solid rgba(0,0,0,0.08); }
    @media (max-width: 768px) {
        .chat-widget { width: 250px; height: 300px; }
    }
    
  </style>
<style>
html, body {
  height: 100%;
  margin: 0;
}
body {
  display: flex;
  flex-direction: column;
  min-height: 100vh;
}
main {
  flex: 1;
}
.site-footer {
  margin-top: auto;
}
</style><style id="fix-gap-css-clean">
/* Proper CSS fix: push content below header without breaking footer */
main > section.container:first-of-type {
  margin-top: 135px !important; /* 120px header + 15px gap */
  padding-top: 0 !important;
  position: static !important;
}
h1.page-title {
  margin-top: 0 !important;
}
</style>
<style id="mobile-categories-gap">
/* Mobile-only spacing between the Categories widget and the footer */
@media (max-width: 900px){
  /* Add breathing room so the categories block isn't stuck to the footer */
  .sidebar .widget:last-of-type{ margin-bottom: 28px !important; }
  /* Ensure overall page has bottom padding on mobile, in case sidebar stacks last */
  main > section.container{ padding-bottom: 28px; }
}
</style>
</head>
<!-- Blog/Post specific assets -->
<link href="https://fonts.googleapis.com" rel="preconnect"/>
<link crossorigin="" href="https://fonts.gstatic.com" rel="preconnect"/>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&amp;display=swap" rel="stylesheet"/>
<script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
<style>
      :root { --container: 1200px; }
      body { font-family: Inter, system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; }
      .container { max-width: var(--container); margin: 0 auto; padding: 0 16px; }
      .page-title { font-size: 32px; font-weight: 700; margin: 24px 0; }
      .toolbar { display:flex; gap:12px; align-items:center; flex-wrap:wrap; margin-bottom:16px; }
      .toolbar input, .toolbar select { padding:10px 12px; border:1px solid #ddd; border-radius:10px; }
      .grid { display:grid; grid-template-columns: 1fr; gap: 16px; }
      @media (min-width: 900px) { .grid { grid-template-columns: 2fr 1fr; gap: 24px; } }
      .card { display:flex; gap:16px; padding:16px; border:1px solid #eee; border-radius:16px; background:#fff; transition: box-shadow .2s; }
      .card:hover { box-shadow: 0 8px 24px rgba(0,0,0,.06); }
      .thumb { width: 220px; height: 140px; border-radius:12px; object-fit: cover; background:#f4f4f4; flex: 0 0 220px; }
      .meta { display:flex; gap:10px; color:#666; font-size: 12px; margin: 6px 0; flex-wrap: wrap; }
      .tag { background:#f2f6ff; color:#2b5cff; padding:4px 8px; border-radius:999px; font-size:11px; }
      .sidebar .widget { border:1px solid #eee; border-radius:16px; padding:16px; background:#fff; }
      .sidebar h3 { font-size:16px; margin:0 0 12px; }
      .pagination { display:flex; gap:8px; justify-content:center; margin: 24px 0 48px; }
      .pagination button { padding:10px 14px; border:1px solid #ddd; background:#fff; border-radius:10px; cursor:pointer; }
      .article { max-width: 900px; margin: 0 auto; }
      .article h1 { font-size:40px; margin: 12px 0 8px; line-height:1.1; }
      .article .lead { color:#555; font-size:18px; }
      .article .byline { color:#666; font-size: 14px; margin: 12px 0 16px; }
      .article .hero { width:100%; border-radius:16px; aspect-ratio:16/9; object-fit:cover; background:#f5f5f5; }
      .article .content { font-size:18px; line-height:1.7; margin-top: 20px; }
      .gallery { display:grid; grid-template-columns: repeat(auto-fill,minmax(220px,1fr)); gap:12px; margin: 20px 0; }
      .gallery img { width:100%; border-radius:12px; aspect-ratio:4/3; object-fit:cover; }
      .video { margin: 20px 0; aspect-ratio:16/9; width:100%; border:0; border-radius:16px; }
      .breadcrumbs { font-size:13px; color:#666; margin: 16px 0; }
      a {text-decoration: none; color: inherit;}
      .title-link:hover {text-decoration: underline;}
    </style>
<body><div class="nav-band"></div><div class="nav">
<div class="nav-left"><a href="https://ibb.co/QGRBCQd"><img alt="Logo" border="0" src="https://i.ibb.co/8Vp3dsc/Screenshot-1.png"/></a></div>
<button aria-label="Open menu" class="nav-burger" id="navBurger">
<span></span><span></span><span></span>
</button>
</div><div class="nav-overlay" id="navOverlay">
<button aria-label="Close menu" class="nav-close" id="navClose">×</button>
<nav class="nav-links">
<a href="index.html">Početna</a>
<a href="about.html">O nama</a>
<a href="catalog.html">Katalog</a><a href="blog.html">Blog</a>
<a href="contact.html">Kontakt</a>
</nav>
</div>
<main>
<section class="container">
<h1 class="page-title">Vesti &amp; Saopštenja</h1>
<div class="toolbar">
<input id="search" placeholder="Pretraga po naslovu, tagu, autoru…" type="search"/>
<select id="tagFilter">
<option value="">Svi tagovi</option>
</select>
<select id="yearFilter">
<option value="">Sve godine</option>
</select>
</div>
<div class="grid">
<div>
<div id="list"></div>
<div class="pagination" id="pagination"></div>
</div>
<aside class="sidebar">
<div class="widget">
<h3>Najčitanije</h3>
<div id="popular"></div>
</div>
<div class="widget" style="margin-top:16px;">
<h3>Kategorije</h3>
<div id="tagsCloud"></div>
</div>
</aside>
</div>
</section>
<script>
const EXCEL_FILE = 'news.xlsx';
const PAGE_SIZE = 8;
let ALL = [];
let FILTERED = [];
let PAGE = 1;
function slugify(s){return s.toString().toLowerCase().normalize('NFD').replace(/[\u0300-\u036f]/g,'').replace(/[^a-z0-9]+/g,'-').replace(/(^-|-$)/g,'');}
function fmtDate(d){try{const x = new Date(d); return x.toLocaleDateString('sr-RS', {day:'2-digit', month:'2-digit', year:'numeric'});}catch{return d;}}
function el(tag, attrs={}, html=''){const e=document.createElement(tag);Object.entries(attrs).forEach(([k,v])=>e.setAttribute(k,v));e.innerHTML=html;return e;}
function render(){
  const list = document.getElementById('list');
  const pag = document.getElementById('pagination');
  list.innerHTML = '';
  pag.innerHTML = '';
  const start = (PAGE-1)*PAGE_SIZE;
  const pageItems = FILTERED.slice(start, start+PAGE_SIZE);
  for(const item of pageItems){
    const card = el('a', {class:'card', href:`post.html?slug=${encodeURIComponent(item.slug)}`});
    const img = el('img', {class:'thumb', src: item.hero_image || '', alt: item.title});
    const content = el('div', {});
    const tags = (item.tags||'').split(',').filter(Boolean).map(t=>`<span class="tag">${t.trim()}</span>`).join(' ');
    content.innerHTML = `
      <h2 class="title-link">${item.title}</h2>
      <div class="meta">
        <span>${fmtDate(item.date)}</span>
        <span>•</span>
        <span>${item.author||'BALKAN MINING'}</span>
        ${tags?`<span>•</span><span>${tags}</span>`:''}
      </div>
      <p>${item.summary||''}</p>
    `;
    card.appendChild(img);
    card.appendChild(content);
    list.appendChild(card);
  }
  const pages = Math.ceil(FILTERED.length / PAGE_SIZE) || 1;
  for(let i=1;i<=pages;i++){
    const b = el('button', {}, i);
    if(i===PAGE) b.style.fontWeight='700';
    b.addEventListener('click', ()=>{PAGE=i;render();window.scrollTo({top:0,behavior:'smooth'});});
    pag.appendChild(b);
  }
}
function applyFilters(){
  const q = document.getElementById('search').value.toLowerCase().trim();
  const tag = document.getElementById('tagFilter').value;
  const year = document.getElementById('yearFilter').value;
  FILTERED = ALL.filter(it=>{
    const okQ = !q || [it.title, it.subtitle, it.author, it.summary, it.tags].join(' ').toLowerCase().includes(q);
    const okTag = !tag || (it.tags||'').split(',').map(s=>s.trim()).includes(tag);
    const okYear = !year || (new Date(it.date).getFullYear()+'' === year);
    return okQ && okTag && okYear;
  }).sort((a,b)=> new Date(b.date) - new Date(a.date));
  PAGE = 1;
  render();
}
function fillFilters(){
  const tags = new Set();
  const years = new Set();
  ALL.forEach(it=>{
    (it.tags||'').split(',').map(s=>s.trim()).filter(Boolean).forEach(t=>tags.add(t));
    const y = new Date(it.date).getFullYear(); if(!isNaN(y)) years.add(y);
  });
  const tagSel = document.getElementById('tagFilter');
  [...tags].sort().forEach(t=>{ const o=document.createElement('option'); o.value=t; o.textContent=t; tagSel.appendChild(o); });
  const yearSel = document.getElementById('yearFilter');
  [...years].sort((a,b)=>b-a).forEach(y=>{ const o=document.createElement('option'); o.value=y; o.textContent=y; yearSel.appendChild(o); });
}
function renderPopular(){
  const box = document.getElementById('popular');
  box.innerHTML='';
  const top = [...ALL].sort((a,b)=>(b.views||0)-(a.views||0)).slice(0,5);
  top.forEach(it=>{
    const a = el('a', {href:`post.html?slug=${encodeURIComponent(it.slug)}`});
    a.innerHTML = `<div style="display:flex; gap:10px; align-items:center; margin:8px 0;">
      <img src="${it.hero_image||''}" alt="${it.title}" style="width:68px;height:48px;object-fit:cover;border-radius:8px;background:#f2f2f2;">
      <div>
        <div style="font-weight:600; font-size:14px;">${it.title}</div>
        <div class="meta">${fmtDate(it.date)}</div>
      </div>
    </div>`;
    box.appendChild(a);
  });
}
function renderTagsCloud(){
  const box = document.getElementById('tagsCloud');
  const counts = {};
  ALL.forEach(it => (it.tags||'').split(',').map(s=>s.trim()).filter(Boolean).forEach(t => counts[t]=(counts[t]||0)+1));
  const entries = Object.entries(counts).sort((a,b)=>b[1]-a[1]);
  entries.forEach(([t,c])=>{
    const a = document.createElement('a');
    a.href='#'; a.style=`display:inline-block;margin:4px 6px;font-size:${12+Math.min(c,6)*2}px`; a.textContent=t;
    a.addEventListener('click', (e)=>{e.preventDefault(); document.getElementById('tagFilter').value=t; applyFilters();});
    box.appendChild(a);
  });
}
async function loadExcel(){
  const res = await fetch(EXCEL_FILE);
  const buf = await res.arrayBuffer();
  const wb = XLSX.read(buf, {type:'array'});
  const ws = wb.Sheets[wb.SheetNames[0]];
  const rows = XLSX.utils.sheet_to_json(ws, {defval:''});
  ALL = rows.map(r => ({
    id: r.id || '',
    slug: r.slug || slugify(r.title||String(r.id||'')),
    title: r.title || '(bez naslova)',
    subtitle: r.subtitle || '',
    author: r.author || 'BALKAN MINING',
    date: r.date || new Date().toISOString().slice(0,10),
    tags: r.tags || '',
    hero_image: r.hero_image || '',
    video_url: r.video_url || '',
    gallery: r.gallery || '',
    summary: r.summary || '',
    body_html: r.body_html || '',
    views: Number(r.views||0)
  }));
  fillFilters();
  renderPopular();
  renderTagsCloud();
  applyFilters();
}
document.getElementById('search').addEventListener('input', ()=>applyFilters());
document.getElementById('tagFilter').addEventListener('change', ()=>applyFilters());
document.getElementById('yearFilter').addEventListener('change', ()=>applyFilters());
loadExcel();
</script>
</main>
<script>// Hamburger behavior (same as on index)
    const navBurger = document.getElementById('navBurger');
    const navOverlay = document.getElementById('navOverlay');
    const navClose  = document.getElementById('navClose');
    if (navBurger && navOverlay && navClose) {
      navBurger.addEventListener('click', () => { navOverlay.classList.add('open'); });
      navClose.addEventListener('click', () => { navOverlay.classList.remove('open'); });
      navOverlay.addEventListener('click', (e) => { if (e.target === navOverlay) navOverlay.classList.remove('open'); });
    }

    // Data loading from Excel
    async function loadXlsx() {
      const res = await fetch('catalog.xlsx');
      if (!res.ok) throw new Error('Ne mogu da učitam catalog.xlsx');
      const buf = await res.arrayBuffer();
      const wb = XLSX.read(buf, { type: 'array' });
      return {
        PRODUCTS: XLSX.utils.sheet_to_json(wb.Sheets['Products'] || {}, {defval: ''}),
        DIMENSIONS: XLSX.utils.sheet_to_json(wb.Sheets['Dimensions'] || {}, {defval: ''}),
        IMAGES: XLSX.utils.sheet_to_json(wb.Sheets['Images'] || {}, {defval: ''}),
      };
    }

    function minPrice(dims){
      const arr = dims.map(d => Number(d.price_eur || d.price || NaN)).filter(n => isFinite(n));
      return arr.length ? Math.min(...arr) : null;
    }

    function unique(arr) { return [...new Set(arr.filter(Boolean))]; }

    function card(p, price, img){
      const url = 'product.html?id=' + encodeURIComponent(p.id);
      return `<div class="card">
        <a href="${url}">
          <div class="ph">${img ? `<img src="${img}" alt="${p.name||''}" />` : ''}</div>
        </a>
        <div class="body">
          <a href="${url}"><h3>${p.name||''}</h3></a>
          <div class="meta">Boja: ${p.color||'-'} · Obrade: ${p.finishes||'-'}</div>
          <div class="chips">
            <span class="chip">${price!=null ? ('Od ' + price + '€') : 'Cena na upit'}</span>
          </div>
        </div>
      </div>`;
    }

    (async function(){
      const db = await loadXlsx();

      // Build fast lookups
      const imagesByProduct = {};
      db.IMAGES.forEach(i => {
        const k = String(i.product_id || i.productId || '');
        if (!imagesByProduct[k]) imagesByProduct[k] = [];
        imagesByProduct[k].push(i.image_url);
      });
      const dimsByProduct = {};
      db.DIMENSIONS.forEach(d => {
        const k = String(d.product_id || d.productId || '');
        if (!dimsByProduct[k]) dimsByProduct[k] = [];
        dimsByProduct[k].push(d);
      });

      // Populate color/finish filters
      const colors = unique(db.PRODUCTS.map(p=>p.color));
      const finishes = unique(db.PRODUCTS.flatMap(p => (String(p.finishes||'').split(',').map(s=>s.trim()).filter(Boolean))));
      const fColor = document.getElementById('fColor');
      colors.forEach(c => fColor.insertAdjacentHTML('beforeend', `<option value="${c}">${c}</option>`));
      const fFinish = document.getElementById('fFinish');
      finishes.forEach(f => fFinish.insertAdjacentHTML('beforeend', `<option value="${f}">${f}</option>`));

      const grid = document.getElementById('grid');
      const empty = document.getElementById('empty');
      const q = document.getElementById('q');
      const fMin = document.getElementById('fMin');
      const fMax = document.getElementById('fMax');

      function apply(){
        const qv = (q.value||'').toLowerCase();
        const cv = fColor.value;
        const fv = fFinish.value;
        const minv = Number(fMin.value||NaN);
        const maxv = Number(fMax.value||NaN);

        const items = db.PRODUCTS.filter(p => {
          // search
          const txt = (p.name + ' ' + p.description + ' ' + p.color + ' ' + p.finishes).toLowerCase();
          if (qv && !txt.includes(qv)) return false;
          if (cv && p.color !== cv) return false;
          if (fv && !String(p.finishes||'').split(',').map(s=>s.trim()).includes(fv)) return false;
          // price range
          const mp = minPrice(dimsByProduct[String(p.id)] || []);
          if (isFinite(minv) && (mp==null || mp < minv)) return false;
          if (isFinite(maxv) && (mp==null || mp > maxv)) return false;
          return true;
        }).map(p => {
          const pid = String(p.id);
          const img = (imagesByProduct[pid] && imagesByProduct[pid][0]) || p.base_image || '';
          const price = minPrice(dimsByProduct[pid] || []);
          return card(p, price, img);
        });

        grid.innerHTML = items.join('');
        empty.style.display = items.length ? 'none' : 'block';
      }

      q.addEventListener('input', apply);
      fColor.addEventListener('change', apply);
      fFinish.addEventListener('change', apply);
      fMin.addEventListener('input', apply);
      fMax.addEventListener('input', apply);
      document.getElementById('clear').addEventListener('click', () => {
        q.value=''; fColor.value=''; fFinish.value=''; fMin.value=''; fMax.value=''; apply();
      });

      apply();
    })();</script><footer class="site-footer">
<div class="cta">
<div class="inner">
<div>
<h3>Spremni za ponudu?</h3>
<p>Pošaljite nacrt ili količine — odgovaramo istog dana.</p>
</div>
<div class="row"><a class="btn-primary" href="contact.html">Kontakt</a><a class="btn-secondary" download="" href="catalog.xlsx">Preuzmi cenovnik</a><a class="btn-primary" href="javascript:void(0)" onclick="openChatWidget()">Postavi pitanje</a></div>
</div>
</div>
<div class="wrap">
<div class="links">
<a href="about.html">O nama</a>
<a href="catalog.html">Katalog</a><a href="blog.html">Blog</a>
<a href="contact.html">Kontakt</a>
</div>
<div class="links" style="justify-content:flex-end;">
<a href="privacy.html">Politika privatnosti</a>
<a href="terms.html">Uslovi korišćenja</a>
</div>
</div>
<div class="bottom"><div class="inner"><div>© 2025 Plavi tok</div><div></div></div></div>
</footer><div class="chat-widget" id="chatWidget">
<div class="chat-header">Chat sa Grok-om
            <button id="minimizeMaximizeButton" onclick="minimizeMaximizeChatWidget()">-</button>
<button onclick="closeChatWidget()">X</button>
</div>
<div class="chat-body" id="chatBody"></div>
<div class="chat-input">
<input id="chatInput" placeholder="Postavi pitanje..." type="text"/>
<button onclick="sendMessage()">Pošalji</button>
</div>
</div><script>const apiKey = 'xai-2vXaWWEQtbrPxS2BdDkiSaLXuRfUKC94YSrIVuNXVO6STvvXMS2qnIIRPhXwWGPZbAFChnsaVGHHS6ei';
    const endpoint = 'https://api.x.ai/v1/chat/completions';
    let chatOpen = false;
    let isMinimized = false;

    function openChatWidget() {
        const chatWidget = document.getElementById('chatWidget');
        chatOpen = !chatOpen;
        chatWidget.style.display = chatOpen ? 'flex' : 'none';
        if (chatOpen && isMinimized) {
            minimizeMaximizeChatWidget();
        }
    }
    function closeChatWidget() {
        document.getElementById('chatWidget').style.display = 'none';
        chatOpen = false;
    }
    function minimizeMaximizeChatWidget() {
        const chatBody = document.getElementById('chatBody');
        const chatInput = document.querySelector('.chat-input');
        const minimizeMaximizeButton = document.getElementById('minimizeMaximizeButton');
        if (!isMinimized) {
            chatBody.style.display = 'none';
            chatInput.style.display = 'none';
            document.getElementById('chatWidget').style.height = '50px';
            minimizeMaximizeButton.textContent = '+';
            isMinimized = true;
        } else {
            chatBody.style.display = 'block';
            chatInput.style.display = 'flex';
            document.getElementById('chatWidget').style.height = '400px';
            minimizeMaximizeButton.textContent = '-';
            isMinimized = false;
        }
    }
    async function sendMessage() {
        const input = document.getElementById('chatInput');
        const userMessage = input.value.trim();
        if (userMessage) {
            addMessage('user', userMessage);
            input.value = '';
            try {
                const response = await fetch(endpoint, {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${apiKey}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        model: 'grok-4-latest',
                        messages: [
                            { role: 'system', content: 'You are a helpful assistant for Balkan Mining - Mermer Invest.' },
                            { role: 'user', content: userMessage }
                        ],
                        stream: false,
                        temperature: 0
                    })
                });
                const data = await response.json();
                if (response.ok) {
                    addMessage('bot', data.choices[0].message.content || 'Nema odgovora.');
                } else {
                    addMessage('bot', 'Greška: ' + (data.error?.message || 'Server problem'));
                }
            } catch (error) {
                addMessage('bot', 'Greška u konekciji: ' + error.message);
            }
        }
    }
    function addMessage(sender, message) {
        const chatBody = document.getElementById('chatBody');
        const wrap = document.createElement('div');
        wrap.classList.add('message', sender);
        const bubble = document.createElement('div');
        bubble.classList.add('bubble');
        bubble.textContent = message;
        wrap.appendChild(bubble);
        chatBody.appendChild(wrap);
        chatBody.scrollTop = chatBody.scrollHeight;
    }</script></body>
</html>