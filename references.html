<script type="text/javascript">
        var gk_isXlsx = false;
        var gk_xlsxFileLookup = {};
        var gk_fileData = {};
        function filledCell(cell) {
          return cell !== '' && cell != null;
        }
        function loadFileData(filename) {
        if (gk_isXlsx && gk_xlsxFileLookup[filename]) {
            try {
                var workbook = XLSX.read(gk_fileData[filename], { type: 'base64' });
                var firstSheetName = workbook.SheetNames[0];
                var worksheet = workbook.Sheets[firstSheetName];

                // Convert sheet to JSON to filter blank rows
                var jsonData = XLSX.utils.sheet_to_json(worksheet, { header: 1, blankrows: false, defval: '' });
                // Filter out blank rows (rows where all cells are empty, null, or undefined)
                var filteredData = jsonData.filter(row => row.some(filledCell));

                // Heuristic to find the header row by ignoring rows with fewer filled cells than the next row
                var headerRowIndex = filteredData.findIndex((row, index) =>
                  row.filter(filledCell).length >= filteredData[index + 1]?.filter(filledCell).length
                );
                // Fallback
                if (headerRowIndex === -1 || headerRowIndex > 25) {
                  headerRowIndex = 0;
                }

                // Convert filtered JSON back to CSV
                var csv = XLSX.utils.aoa_to_sheet(filteredData.slice(headerRowIndex)); // Create a new sheet from filtered array of arrays
                csv = XLSX.utils.sheet_to_csv(csv, { header: 1 });
                return csv;
            } catch (e) {
                console.error(e);
                return "";
            }
        }
        return gk_fileData[filename] || "";
        }
        </script><!DOCTYPE html>
<html lang="sr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Balkan Mining - Reference</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Montserrat', sans-serif; }
        body { background-color: #f5f5f5; }
        nav { background-color: #333; padding: 1rem; position: sticky; top: 0; z-index: 100; }
        nav ul { list-style: none; display: flex; justify-content: center; gap: 2rem; }
        nav a { color: white; text-decoration: none; font-size: 1.1rem; }
        .menu-toggle { display: none; font-size: 1.5rem; color: white; cursor: pointer; }
        .section { padding: 4rem 2rem; text-align: center; }
        footer { background-color: #333; color: white; padding: 2rem; text-align: center; }
        #chatbot { position: fixed; bottom: 20px; right: 20px; z-index: 1000; }
        @media (max-width: 768px) {
            .menu-toggle { display: block; }
            nav ul { display: none; flex-direction: column; position: absolute; top: 60px; left: 0; width: 100%; background-color: #333; }
            nav ul.active { display: flex; }
            nav a { padding: 1rem; font-size: 1rem; }
        }
    </style>
</head>
<body>
    <nav>
        <div class="menu-toggle"><i class="fas fa-bars"></i></div>
        <ul>
            <li><a href="index.html">Početna</a></li>
            <li><a href="about.html">O nama</a></li>
            <li><a href="catalog.html">Katalog</a></li>
            <li><a href="references.html">Reference</a></li>
            <li><a href="blog.html">Blog</a></li>
            <li><a href="contact.html">Kontakt</a></li>
        </ul>
    </nav>
    <section class="section" id="references">
        <h2>Reference</h2>
        <p>Ova stranica je u izradi. Uskoro će biti dodan sadržaj.</p>
    </section>
    <footer>
        <p>&copy; 2025 Balkan Mining. Sva prava zadržana. info@balkanmining.com</p>
    </footer>
    <div id="chatbot">
        <script type="text/javascript">
            var Tawk_API=Tawk_API||{}, Tawk_LoadStart=new Date();
            (function(){
            var s1=document.createElement("script"),s0=document.getElementsByTagName("script")[0];
            s1.async=true;
            s1.src='https://embed.tawk.to/YOUR_TAWK_ID/default';
            s1.charset='UTF-8';
            s1.setAttribute('crossorigin','*');
            s0.parentNode.insertBefore(s1,s0);
            })();
        </script>
    </div>
    <script>
        const menuToggle = document.querySelector('.menu-toggle');
        const navUl = document.querySelector('nav ul');
        menuToggle.addEventListener('click', () => {
            navUl.classList.toggle('active');
        });
    </script>

<!-- XAPI Chat + Nav bootstrap (non-intrusive, no keys in front) -->
<script>
(function(){
  const $ = (s, root=document)=>root.querySelector(s);
  const $$ = (s, root=document)=>Array.from(root.querySelectorAll(s));
  const endpoint = '/sajt/xapi/chat.php';

  function ensureHamburger(){
    const hamb = $('.hamburger');
    const menu = $('.nav-menu');
    const close = $('.close-btn');
    if (hamb && menu){ hamb.addEventListener('click', ()=> menu.classList.add('active')); }
    if (close && menu){ close.addEventListener('click', ()=> menu.classList.remove('active')); }
  }

  function getChatParts(){
    const panel = $('.chat-widget') || $('#chatWidget') || $('.chat-panel') || $('.chat-container');
    const body  = $('.chat-body') || $('.chat-messages') || $('#chatMessages') || panel;
    const input = $('#chatInput') || (panel && panel.querySelector('.chat-input input')) || $('input#chat') || $('input[name=chat]');
    const send  = $('#chatSend') || (panel && panel.querySelector('.chat-input button')) || $('button.send') || $('button#sendMessage');
    return {panel, body, input, send};
  }

  function openChat(){
    const {panel} = getChatParts();
    if (!panel) return;
    if (getComputedStyle(panel).display === 'none') {
      panel.style.display = (panel.classList.contains('chat-widget') ? 'flex' : 'block');
    }
    panel.classList.add('open');
  }
  function closeChat(){
    const {panel} = getChatParts();
    if (!panel) return;
    panel.classList.remove('open');
    if (panel.classList.contains('chat-widget')) panel.style.display = 'none';
  }
  window.openChat = openChat;

  function wireOpeners(){
    const openers = $$('[data-open-chat], .chat-button, .open-chat, #openChat, a.chat-button, button.chat-button');
    openers.forEach(el => el.addEventListener('click', (e)=>{ e.preventDefault(); openChat(); }));
    const closer = $('.chat-close, #chatClose, .chat-header button.close, .chat-header .close-btn');
    if (closer) closer.addEventListener('click', (e)=>{ e.preventDefault(); closeChat(); });
  }

  function addMessage(role, text){
    const {body} = getChatParts();
    if (!body) return;
    const row = document.createElement('div');
    row.className = 'msg ' + role;
    row.textContent = String(text ?? '');
    body.appendChild(row);
    body.scrollTop = body.scrollHeight;
  }
  window.addMessage = window.addMessage || addMessage;

  async function sendMessage(){
    const {input} = getChatParts();
    if (!input) return;
    const msg = (input.value || '').trim();
    if (!msg) return;
    addMessage('user', msg);
    input.value='';
    try{
      const res = await fetch(endpoint, {
        method:'POST',
        headers:{'Content-Type':'application/json'},
        body: JSON.stringify({ message: msg })
      });
      let text = '';
      try {
        const data = await res.json();
        text = data?.reply || data?.message || data?.choices?.[0]?.message?.content || JSON.stringify(data);
      } catch(_) {
        text = await res.text();
      }
      addMessage('bot', text || 'Prazan odgovor.');
    }catch(err){
      console.error(err);
      addMessage('bot','Greška: server nije dostupan.');
    }
  }
  window.sendMessage = window.sendMessage || sendMessage;

  function wireSenders(){
    const {input, send} = getChatParts();
    const form = (input && input.closest('form'));
    if (send) send.addEventListener('click', (e)=>{ e.preventDefault(); sendMessage(); });
    if (input) input.addEventListener('keydown', (e)=>{ if(e.key==='Enter'){ e.preventDefault(); sendMessage(); } });
    if (form) form.addEventListener('submit', (e)=>{ e.preventDefault(); sendMessage(); });
  }

  document.addEventListener('DOMContentLoaded', function(){
    ensureHamburger();
    wireOpeners();
    wireSenders();
  });
})();
</script>


<!-- MINIMAL PATCH: keep layout; proxy any model fetch to /sajt/xapi/chat.php -->
<script>
(function(){
  try {
    // Avoid ReferenceError in legacy code
    if (typeof window.apiKey === 'undefined') {
      window.apiKey = 'proxied';
    }

    const ORIG_FETCH = window.fetch.bind(window);
    window.fetch = async function(input, init){
      try{
        const url = (typeof input === 'string') ? input : (input && input.url) || '';
        const isModelApi = /api\.x\.ai|openai|anthropic|groq/i.test(url);
        if (!isModelApi) {
          return ORIG_FETCH(input, init);
        }

        // Try to extract user's message from the original body if present
        let userMsg = '';
        try {
          const bodyStr = init && init.body ? (typeof init.body === 'string' ? init.body : JSON.stringify(init.body)) : '';
          if (bodyStr) {
            const payload = JSON.parse(bodyStr);
            userMsg = payload?.message 
                   || payload?.prompt 
                   || (Array.isArray(payload?.messages) ? (payload.messages.at(-1)?.content || '') : '');
          }
        } catch(e){ /* ignore parse errors */ }

        const resp = await ORIG_FETCH('/sajt/xapi/chat.php', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ message: userMsg || '' })
        });
        return resp;
      }catch(err){
        // Fallback to original fetch if anything goes wrong
        return ORIG_FETCH(input, init);
      }
    };
  } catch(e) {
    console.error('Proxy bootstrap error:', e);
  }
})();
</script>

</body>
</html>